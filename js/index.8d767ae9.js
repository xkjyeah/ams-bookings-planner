(function(t){function e(e){for(var i,s,o=e[0],l=e[1],u=e[2],d=0,p=[];d<o.length;d++)s=o[d],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&p.push(r[s][0]),r[s]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);c&&c(e);while(p.length)p.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],i=!0,o=1;o<n.length;o++){var l=n[o];0!==r[l]&&(i=!1)}i&&(a.splice(e--,1),t=s(s.s=n[0]))}return t}var i={},r={index:0},a=[];function s(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=i,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(n,i,function(e){return t[e]}.bind(null,i));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/ams-bookings-planner/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var u=0;u<o.length;u++)e(o[u]);var c=l;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("cd49")},"00d9":function(t,e,n){"use strict";var i=n("cff9"),r=n.n(i);r.a},"0430":function(t,e,n){"use strict";var i=n("de9b"),r=n.n(i);r.a},"089a":function(t,e,n){},"0b09":function(t,e,n){"use strict";var i=n("1cf1"),r=n.n(i);r.a},1537:function(t,e,n){},"1adb":function(t,e,n){"use strict";var i=n("eaa3"),r=n.n(i);r.a},"1ae8":function(t,e,n){},"1cf1":function(t,e,n){},"20ad":function(t,e,n){"use strict";var i=n("2a57"),r=n.n(i);r.a},"274b":function(t,e,n){},2839:function(t,e,n){},"2a57":function(t,e,n){},"2cc6":function(t,e,n){"use strict";var i=n("e14d"),r=n.n(i);r.a},"2f76":function(t,e,n){},"36db":function(t,e,n){},"458f":function(t,e,n){},"47cb":function(t,e,n){},4801:function(t,e,n){"use strict";var i=n("60ee"),r=n.n(i);r.a},"4b77":function(t,e,n){"use strict";var i=n("2839"),r=n.n(i);r.a},"56ff":function(t,e,n){},"59ed":function(t,e,n){},"5a95":function(t,e,n){"use strict";var i=n("5cbe"),r=n.n(i);r.a},"5c0b":function(t,e,n){"use strict";var i=n("458f"),r=n.n(i);r.a},"5cbe":function(t,e,n){},"60ee":function(t,e,n){},"672f":function(t,e,n){"use strict";var i=n("089a"),r=n.n(i);r.a},"677e":function(t,e,n){"use strict";var i=n("7dde"),r=n.n(i);r.a},"6a26":function(t,e,n){"use strict";var i=n("36db"),r=n.n(i);r.a},"78e9":function(t,e,n){},"7dde":function(t,e,n){},"7df8":function(t,e,n){},"83a8":function(t,e,n){"use strict";var i=n("7df8"),r=n.n(i);r.a},"92a9":function(t,e,n){"use strict";var i=n("b740"),r=n.n(i);r.a},"933c":function(t,e,n){"use strict";var i=n("ff08"),r=n.n(i);r.a},"9afb":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH5AEECDE3g/C+1gAAAm5JREFUOMutlMtL1FEUxz/3/ubhiIRpNmpDjo0R9CBqFS0Uk5DayKANuBaVSg2nzARp5UbFASGVDEFKEiZFRGoT6t/gwlWIJuIDn9jkzG8ev9tiSnyUls2Buzrnfu75nnPugUTbQE1iWWKghjzAa8QwK4U6EUkgNI0I4DMBn5XC6ci7ZiQln5L/jBSgBwMszEwhBPdMUmrONLuTjZWv0l3ZgbQkgfpLqhAQizHyxktGtouNlTmnVMqguLyZtLM5+LseEdxeB2WAETv6KAM9sIX/1UNS07MpLm9GKQMJEAkHKSx7Rkb2RUb7GoiGQ8cmZ8SijPY9Jz0zl8KyBiLhIEAcGI8wKPK8ICvnKiO9XvRQwEDsutVemZFwiJHeuMwiTyMYxq5bHniWAk8jdsclPnTVEgps7np+QSN6kOHXT0g946CwvHkf7DAQQA+SX1LHhcu35Fh/E+HQdxBCQwhhGDHG+pvIOn+FO6VPQQ8eui5/Vx+lDCJhnWg0wlBPLTvb6+g73xjqrkXf2T6ytoeBVhsTwx0szU/jedyNw3VDfXzbzKd3L0nPzOVBTQ9L89NMDHeA1XYMUEomB1vYWlugtLoTzWQh310vzrlukmZ3UuRpxGS2UlrdydbaApODLSDlH4BSMu5vZXVxBneVD7MlKd6HWJTb96socNfHG6AUZksS7iofq4szjPtb90ElgNliY3KonfXlWUoq2pCa6cDQ/Rz0vZloJkoq2lhfnmVyqB2zJS5fvK/TVJrdyU5gE3elDzTtRF8vOeU0GytziIEaZpXC6XBdx2pL4T+Xw5wJuCsE3vkvU2YSsL4SvmATbj8Ap8IMoZKaQv4AAAAASUVORK5CYII="},a09b:function(t,e,n){"use strict";var i=n("47cb"),r=n.n(i);r.a},a676:function(t,e,n){"use strict";var i=n("59ed"),r=n.n(i);r.a},ad04:function(t,e,n){"use strict";var i=n("274b"),r=n.n(i);r.a},b47d:function(t,e,n){"use strict";var i=n("1ae8"),r=n.n(i);r.a},b740:function(t,e,n){},bed4:function(t,e,n){"use strict";var i=n("56ff"),r=n.n(i);r.a},cd49:function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("2b0e"),r=n("2f62");i["default"].use(r["a"]);var a=i["default"],s=n("ce5b"),o=n.n(s),l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-app",{staticClass:"app"},[n("RequiresLogin",[n("App")],1)],1)},u=[],c=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-layout",{staticClass:"app-app",attrs:{column:""}},[n("v-layout",{staticClass:"controls",class:{"app-showing-template":"template"===t.$store.state.trips.mode.type,"hidden-in-print":!0},attrs:{row:""}},["date"===t.$store.state.trips.mode.type?n("DatePicker",{staticStyle:{flex:"0 0 100px"}}):t._e(),"template"===t.$store.state.trips.mode.type?n("h2",[n("v-icon",{on:{click:function(e){return t.goBack()}}},[t._v("chevron_left")]),t._v(" "+t._s(t.templateName)+" ")],1):t._e(),n("v-spacer"),n("div",[t._v(" "+t._s(t.$store.state.login.user)+" ")]),n("v-btn",{on:{click:function(e){return t.showDialog("manifest")}}},[t._v(" Show Manifest ")]),n("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[n("v-btn",t._g({},i),[n("v-icon",[t._v("settings")])],1)]}}])},[n("v-list",[n("v-list-tile",{on:{click:function(e){return t.showDialog("teams")}}},[t._v(" Teams ")]),n("v-list-tile",{on:{click:function(e){return t.showDialog("persons")}}},[t._v(" Individuals ")]),n("v-list-tile",{on:{click:function(e){return t.showDialog("templates")}}},[t._v(" Job templates ")]),n("v-list-tile",{on:{click:function(e){return t.showDialog("messages")}}},[t._v(" SMS History ")]),n("v-divider"),n("v-list-tile",{on:{click:function(e){return t.signOut()}}},[t._v(" Sign out ")])],1)],1)],1),n("TripEditor",{staticClass:"trip-editor-window hidden-in-print"}),n("ChartArea",{ref:"chart-area",staticClass:"chart-area hidden-in-print",attrs:{xAxisScale:t.xAxisScale,yAxisScale:t.yAxisScale},on:{"trip-clicked":function(e){return t.$store.commit("tripEditing/editTrip",e)}}}),n("v-btn",{staticClass:"hidden-in-print",staticStyle:{bottom:"1em",right:"2em",position:"absolute"},attrs:{dark:"",fab:"",color:"pink"},on:{click:t.createNewTrip}},[n("v-icon",[t._v("add")])],1),n("TimeUpdater"),n("VehiclesSync"),n("TripsSync"),n("PrintableManifest"),"teams"===t.$store.state.dialogs.activeDialog?n("TeamsDialog"):"persons"===t.$store.state.dialogs.activeDialog?n("PersonsDialog"):"manifest"===t.$store.state.dialogs.activeDialog?n("ManifestDialog"):"messages"===t.$store.state.dialogs.activeDialog?n("MessagesDialog"):"draftMessage"===t.$store.state.dialogs.activeDialog?n("DraftMessageDialog",t._b({},"DraftMessageDialog",t.$store.state.dialogs.props,!1)):"importTeams"===t.$store.state.dialogs.activeDialog?n("ImportTeamsDialog"):"templates"===t.$store.state.dialogs.activeDialog?n("TemplatesDialog"):t._e()],1)},d=[],p=(n("7db0"),n("b0c0"),n("07ac"),n("2ef0")),m=n.n(p),f=(n("a4d3"),n("e01a"),n("99af"),n("4de4"),n("5db7"),n("d81d"),n("a434"),n("73d9"),n("b64b"),n("d3b7"),n("acd8"),n("e25e"),n("ac1f"),n("25f0"),n("3ca3"),n("4d90"),n("5319"),n("498a"),n("159b"),n("ddb0"),n("9ab4")),h=function(t){return t.endTime||(t.startTime||0)+18e5},v=function(){return Date.now().toString(35).padStart(10,"z")+Math.floor(2e9*Math.random()).toString(35).padStart(7,"z")},g=n("f654"),T=n.n(g),y=n("59ca"),b=n.n(y),w=(n("66ce"),n("ea7b"),{apiKey:"AIzaSyD13f_m0clyvTunsWRoyvhmBF1r5Lrqt4w",authDomain:"ams-bookings-planner.firebaseapp.com",databaseURL:"https://ams-bookings-planner.firebaseio.com",projectId:"ams-bookings-planner",storageBucket:"ams-bookings-planner.appspot.com",messagingSenderId:"553699052004"});b.a.initializeApp(w);var _=b.a.database(),S=b.a.auth(),x=n("b9b9"),D=n.n(x);function A(t){return t?t.driver&&t.medic?t.driver.toString().trim().toLowerCase()+" "+t.medic.toString().trim().toLowerCase():t.driver?t.driver.toString().trim().toLowerCase():t.medic?t.medic.toString().trim().toLowerCase():null:null}function E(t){var e=A(t);return"x"+(e||"")}var C=E({driver:null,medic:null}),k={namespaced:!0,state:function(){return{scheduleByTeam:{},teams:[],savesDisabled:!1,mode:{type:"date",timestamp:Date.now()},inFlightPromise:null,autoUpdate:{teams:[],trips:[],teamsKey:"a",tripsKey:"b"},trips:{}}},getters:{trips:function(t){return m.a.flatMap(Object.values(t.scheduleByTeam),(function(e){return m.a.flatMap(e.rows,(function(e){return e.map((function(e){return t.trips[e]}))}))}))},rowCount:function(t){return m.a.sumBy(t.teams,(function(e){return t.scheduleByTeam[E(e)]?t.scheduleByTeam[E(e)].rows.length:0}))},teamIndexForRow:function(t){return function(e){var n,i,r=0,a=0;try{for(var s=f["e"](t.teams),o=s.next();!o.done;o=s.next()){var l=o.value,u=t.scheduleByTeam[E(l)].rows;if(e<r+u.length)return a;r+=u.length,a+=1}}catch(c){n={error:c}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return null}},teamForRow:function(t){return function(e){var n,i,r=0;try{for(var a=f["e"](t.teams),s=a.next();!s.done;s=a.next()){var o=s.value,l=t.scheduleByTeam[E(o)].rows;if(e<r+l.length)return o;r+=l.length}}catch(u){n={error:u}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return null}},canonicalOffsetForRow:function(t){return function(e){var n,i,r=0;try{for(var a=f["e"](t.teams),s=a.next();!s.done;s=a.next()){var o=s.value,l=t.scheduleByTeam[E(o)].rows;if(e<r+l.length)return r;r+=l.length}}catch(u){n={error:u}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return null}},teamSchedules:function(t){var e=m.a.flatMap(t.teams,(function(e){var n=E(e),i=t.scheduleByTeam[n]||{trips:[],rows:[[]]};return i.rows.map((function(n,r){return[e,{trips:n.map((function(e){return t.trips[e]})),row:r,rowCount:i.rows.length}]}))}));return e}},mutations:{reorderTeam:function(t,e){var n,i;if(!t.savesDisabled){var r=e.oldIndex,a=e.newIndex;if(r!==a){if(r<a){var s=t.teams.splice(e.oldIndex,1);(n=t.teams).splice.apply(n,f["d"]([e.newIndex-1,0],s))}else{s=t.teams.splice(e.oldIndex,1);(i=t.teams).splice.apply(i,f["d"]([e.newIndex,0],s))}B(t.mode,t.teams)}}},assignNewlyCreatedJob:function(t,e){if(!t.savesDisabled){var n=e.trip,r=t.scheduleByTeam[E(n)];if(r)r.rows=N(m.a.flatten(r.rows).map((function(e){return t.trips[e]})));else{var a={driver:n.driver,medic:n.medic,vehicle:null};t.teams.splice(0,0,a),i["default"].set(t.scheduleByTeam,E(a),{rows:[[n.id]]})}W(t.mode,n)}},reassignJob:function(t,e){if(!t.savesDisabled&&null!==e.team){var n=E(e.trip),i=E(e.team),r=t.scheduleByTeam[n],a=t.scheduleByTeam[i];T()(r,"Trip does not exist in From"),a||(i!==C?T()(a,"Trip does not exist in To"):(a=t.scheduleByTeam[C]={rows:[[e.trip.id]]},t.teams.splice(0,0,{driver:null,medic:null,vehicle:null})));var s=m.a.flatten(r.rows).filter((function(t){return t!==e.trip.id})).map((function(e){return t.trips[e]}));r.rows=N(s);var o=m.a.flatten(a.rows).map((function(e){return t.trips[e]})),l=f["a"]({},e.trip,{driver:e.team.driver,medic:e.team.medic,updated:Date.now()});a.rows=N(f["d"](o,[l])),W(t.mode,l)}},updateTeams:function(t,e){t.teams=e,t.scheduleByTeam=e.reduce((function(e,n){var i=E(n);return e[i]=t.scheduleByTeam[i]||{trips:[],rows:[[]]},e}),{}),t.savesDisabled||B(t.mode,t.teams)},importJobs:function(t,e){var n=m.a.flatten(e.map((function(t){var e=t.trip&&f["a"]({id:v()},t,t.trip),n=t.secondTrip&&f["a"]({id:v()},t,t.secondTrip);return e&&n?[e,n]:e||n?[e||n]:[]}))),i=m.a.mapValues(m.a.keyBy(n,E),(function(t){return{driver:t.driver,medic:t.medic,vehicle:null}})),r=m.a.groupBy(n,E);t.teams=m.a.values(i).map((function(t){return f["a"]({},t,{vehicle:null})})),t.scheduleByTeam=m.a.fromPairs(t.teams.map((function(t){var e=E(t);return[e,{trips:r[e],rows:N(r[e])}]}))),B(t.mode,t.teams),m.a.values(r).forEach((function(e){e.forEach((function(e){W(t.mode,e)}))}))},updateTrip:function(t,e){var n,i;T()(!("driver"in e.updates)),T()(!("medic"in e.updates));var r=t.trips[e.tripId],a=t.scheduleByTeam[E(r)];T()(r);try{for(var s=f["e"](Object.keys(e.updates)),o=s.next();!o.done;o=s.next()){var l=o.value;r[l]=e.updates[l]}}catch(u){n={error:u}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}r.updated=Date.now(),("startTime"in e.updates||"endTime"in e.updates)&&(a.rows=N(m.a.flatten(a.rows).map((function(e){return t.trips[e]})))),t.savesDisabled||W(t.mode,r)},markTripSMSSent:function(t,e){var n=t.trips[e.tripId];n.lastSMSTimestamp=Date.now(),W(t.mode,n)},deleteTrip:function(t,e){var n=t.trips[e.tripId],i=t.scheduleByTeam[E(n)];i.rows=N(m.a.flatten(i.rows).filter((function(t){return t!==n.id})).map((function(e){return t.trips[e]}))),U(t.mode,n)},_setMode:function(t,e){t.mode=e},_disableSaves:function(t,e){t.savesDisabled=!0,t.inFlightPromise=e},_enableSaves:function(t){t.savesDisabled=!1},_setTrips:function(t,e){t.trips=e},_setSchedules:function(t,e){t.scheduleByTeam=e,t.inFlightPromise=null},_autoUpdateTrips:function(t,e){if("teams"in e)t.autoUpdate.teams=e.teams,t.autoUpdate.teamsKey=e.teamsKey;else{if(!("trips"in e))throw new Error("unexpected value for options");t.autoUpdate.trips=e.trips,t.autoUpdate.tripsKey=e.tripsKey}}},actions:{setMode:function(t,e){var n=t.state,i=n.mode;if("date"===i.type&&"date"===e.type){if(i.timestamp===e.timestamp)return}else if("template"===i.type&&"template"===e.type&&i.template===e.template)return;var r=P(e),a=K(e),s=Promise.all([r,a]).then((function(i){var r=f["b"](i,2),a=r[0],o=r[1];s==n.inFlightPromise&&(t.dispatch("_setTripsAndTeams",{teams:a,trips:o,mode:e}),q(e))}));t.commit("_disableSaves",s)},autoUpdateTrips:function(t,e){t.commit("_autoUpdateTrips",e);var n=t.state.autoUpdate.tripsKey.replace(/^\/trips\//,""),i=t.state.autoUpdate.teamsKey.replace(/^\/trips\//,"");n===i&&$(t.state.mode)===n&&t.dispatch("_setTripsAndTeams",{trips:t.state.autoUpdate.trips,teams:t.state.autoUpdate.teams,mode:t.state.mode})},_setTripsAndTeams:function(t,e){var n=f["b"](O(e.teams,e.trips),3),i=n[0],r=n[1],a=n[2];t.commit("updateTeams",i),t.commit("_setTrips",a),t.commit("_setSchedules",r),t.commit("_setMode",e.mode),t.commit("_enableSaves")}}};function $(t){return"date"===t.type?L(new Date(t.timestamp)):t.template}function L(t){return D()(t,"yyyy-mm-dd")}function B(t,e){_.ref("/teams/"+$(t)).set(M(e))}function M(t){return t.reduce((function(t,e,n){return t[n.toString().padStart(9,"0")]=e,t}),{})}function I(t){var e=m.a.sortBy(Object.keys(t).map((function(t){return[t,parseInt(t)]})).filter((function(t){var e=f["b"](t,2),n=e[0],i=e[1];return!!isFinite(i)||(console.error("Encountered non-integer key "+n),!1)})),(function(t){return t[1]}));return e.map((function(e){return t[e[0]]}))}function P(t){return _.ref("/teams/"+$(t)).once("value").then((function(t){return H(t)}))}function H(t){var e=t.val()||{};return I(e).map((function(t){return{driver:t.driver||null,medic:t.medic||null,vehicle:t.vehicle||null}}))}function O(t,e){var n=m.a.mapValues(m.a.keyBy(t.filter((function(t){return t.driver||t.medic})),E),(function(t){return{driver:t.driver,medic:t.medic}})),i=m.a.groupBy(e,E),r=Object.keys(i).filter((function(t){return!(t in n)})).map((function(t){var e=i[t][0],n=e.driver,r=e.medic;return{driver:n,medic:r,vehicle:null}})),a=r.concat(t),s=m.a.fromPairs(a.map((function(t){var e=E(t),n=i[e]||[];return[e,{rows:N(n)}]})));return[a,s,m.a.keyBy(e,"id")]}function N(t){var e=[],n=function(t){return t[t.length-1]},i=m.a.sortBy(t,(function(t){return t.startTime})),r=function(t,e){return Math.min(h(t),h(e))>Math.max(t.startTime,e.startTime)};return i.forEach((function(t){var i=e.find((function(e){var i=n(e);return!r(t,i)}));i?i.push(t):e.push([t])})),0===e.length&&e.push([]),e.map((function(t){return t.map((function(t){return t.id}))}))}var R={};function F(t,e){var n=R[e].backlog;return R[e].state="inflight",R[e].backlog=null,_.ref(t).set(n).then((function(){R[e].backlog?F(t,e):delete R[e]})).catch((function(){R[e].state="errored",R[e].backlog?(R[e].backlog=f["a"]({},n,R[e].backlog),F(t,e)):R[e].backlog=n}))}function j(t,e,n){e in R&&"inflight"===R[e].state?R[e].backlog=f["a"]({},R[e].backlog,n):e in R&&"errored"===R[e].state?(R[e].backlog=f["a"]({},R[e].backlog,n),F(t,e)):e in R||(R[e]={backlog:n,state:"inflight"},F(t,e))}function V(t){return R[t]&&R[t].backlog||null}function W(t,e){if(!e.id)throw new Error("A trip has no ID for syncing!");var n="/trips/"+$(t)+"/"+e.id;j(n,e.id,e)}function U(t,e){T()(e.id,"Wanted to delete a trip without an ID"),_.ref("/trips/"+$(t)+"/"+e.id).set(null)}function X(t){if(!t)return null;var e=isFinite(t&&t.lat)?parseFloat(t.lat):null,n=isFinite(t&&t.lng)?parseFloat(t.lng):null;return null!==e&&null!==n?{lat:e,lng:n}:null}function K(t){return _.ref("/trips/"+$(t)).once("value").then((function(t){return G(t)}))}function G(t){var e=t.val()||{};return m.a.values(e).map((function(t){return{driver:t.driver||null,medic:t.medic||null,startTime:isFinite(t.startTime)?Math.max(0,Math.min(972e5,parseInt(t.startTime))):432e5,endTime:isFinite(t.endTime)?parseInt(t.endTime):null,id:t.id||v(),description:t.description||"",startPostcode:t.startPostcode||null,endPostcode:t.endPostcode||null,startAddress:t.startAddress||null,endAddress:t.endAddress||null,startLocation:t.startLocation||null,endLocation:t.endLocation||null,startLatLng:X(t.startLatLng),endLatLng:X(t.endLatLng),isTentative:!!t.isTentative,relatedTrip:t.relatedTrip||null,hideFromManifest:!!t.hideFromManifest,isReturnTrip:!!t.isReturnTrip,type:t.type||"<No type>",price:isFinite(t.price)?parseInt(t.price):null,cancelled:t.cancelled||!1,created:t.created||Date.now(),updated:t.updated||Date.now(),templateTrip:t.templateTrip||null,messages:t.messages?I(t.messages):[],lastSMSTimestamp:t.lastSMSTimestamp||null}}))}var J=n("b383"),z=n.n(J);function q(t){if("date"===t.type){var e=L(new Date(t.timestamp));window.history.pushState(null,e,"#"+z.a.stringify({date:e}))}else if("template"===t.type){e=L(new Date(t.lastTimestamp));window.history.pushState(null,t.template,"#"+z.a.stringify({template:t.template,lastTimestamp:e}))}}function Y(t){var e=function(){var t=z.a.parse(window.location.hash.substring(1));if(t.date){var e=new Date(t.date);return isFinite(e.getTime())?{type:"date",timestamp:e.getTime()}:null}if(t.template){var n=t.template;e=new Date(t.lastTimestamp);return{type:"template",template:n,lastTimestamp:isFinite(e.getTime())?e.getTime():Date.now()}}return null},n=function(){var n=e();return!!n&&(t.dispatch("trips/setMode",n),!0)};window.addEventListener("popstate",n),n()}var Q=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("PlannerChart",{staticClass:"planner-chart",attrs:{xAxisScale:t.xAxisScale,yAxisScale:t.yAxisScale},nativeOn:{scroll:function(e){return t.onScroll(e)}},scopedSlots:t._u([{key:"background-svg",fn:function(e){return[n("svg",{attrs:{width:.5*t.screenWidth+t.chartAreaWidth+e.yAxisWidth,height:t.chartAreaHeight+e.xAxisHeight},on:{dblclick:t.createNewTrip}},[n("HorizontalGridLines",{attrs:{rowHeight:t.yAxisScale,width:t.chartAreaWidth}}),n("VerticalGridLines",{attrs:{columnWidth:t.xAxisScale,n:24,height:t.chartAreaHeight}}),n("CurrentTime",{attrs:{columnWidth:t.xAxisScale,height:t.chartAreaHeight}})],1)]}},{key:"x-axis",fn:function(e){return t._l(t._.range(0,24),(function(i){return n("div",{key:i,staticStyle:{cursor:"pointer"},style:{left:e.scale*i+"px",bottom:"0",position:"absolute",width:t.xAxisScale+"px"},on:{click:function(e){return t.scrollToTime(36e5*i)}}},[t._v(" "+t._s(i)+":00 ")])}))}},{key:"y-axis",fn:function(e){return[n("TeamList",{attrs:{teamSchedules:t.teamSchedules,scale:e.scale}})]}}])},[[t._l(t.teamSchedules,(function(e,i){e[0];var r=e[1];return t._l(r.trips,(function(e,r){return n("TripBar",{directives:[{name:"draggable",rawName:"v-draggable"}],key:e.id,attrs:{isSelected:e.id===t.$store.state.tripEditing.tripBeingEdited,trip:e,yIndexFunction:function(t){return i}},on:{click:function(n){return t.tripClicked(e)}},nativeOn:{dragstart:function(n){return t.onDragStart(n,e,i)},dragend:function(e){return t.onDragEnd()}}})}))})),t._l(t.teamSchedules,(function(e,i){var r=e[0],a=e[1];return[r.vehicle&&0===a.row?n("VehicleMarker",{key:i,attrs:{vehicle:r.vehicle,rowCount:a.rowCount,yIndex:i}}):t._e()]}))]],2)},Z=[],tt=(n("a9e3"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("transition-group",{attrs:{name:"team-list",tag:"div"}},t._l(t.teamSchedules,(function(e,i){var r=e[0],a=e[1];return n("div",{key:r.driver+","+r.medic+","+a.row,staticClass:"team-marker",class:{"is-dragged":t.dragIndex===i},style:{"text-align":"right",left:"0",right:"0",height:t.scale+"px",top:t.scale*i+"px",position:"absolute","user-select":"none"},attrs:{draggable:""},on:{drop:function(e){return t.onDrop(e,1)},dragstart:function(e){return t.onDragStart(e,i)},dragend:function(e){return t.onDragEnd()},dragover:function(e){return t.onDragOver(e,i)}}},[r.driver||r.medic?[n("span",[t._v(t._s(r.driver)+", "+t._s(r.medic)+" ")]),n("VehicleLabel",{attrs:{value:r.vehicle,right:""}})]:[n("em",{staticClass:"not-assigned"},[t._v("Not assigned")])]],2)})),0),t.isDragging?n("div",{staticClass:"placeholder",style:{top:t.scale*t.destinationIndex+"px"}}):t._e()],1)}),et=[],nt=(n("caad"),n("2532"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.vehiclesById[t.value]?n("VehicleTooltip",t._b({attrs:{value:t.vehiclesById[t.value]}},"VehicleTooltip",t.$attrs,!1),[t._t("before"),t.vehiclesById[t.value]?n("span",{staticClass:"vehicle",class:{stale:t.stale(t.vehiclesById[t.value])},style:{"background-color":t.singaporeColors(t.vehiclesById[t.value])}}):t._e(),t._t("after")],2):t._e()}),it=[],rt=n("53ca"),at={namespaced:!0,state:function(){return{vehicles:[],persons:{}}},getters:{vehiclesById:function(t){return m.a.keyBy(t.vehicles,"registrationNumber")},personArray:function(t){return m.a.sortBy(Object.values(t.persons),(function(t){return t.name}))}},mutations:{setVehicles:function(t,e){t.vehicles=e},setPersons:function(t,e){t.persons=m.a.keyBy(e,(function(t){return t.name.toLowerCase()}))},updatePerson:function(t,e){var n;t.persons=f["a"]({},t.persons,(n={},n[e.name.toLowerCase()]=e,n)),st(e)},deletePerson:function(t,e){var n=t.persons,i=e.name.toLowerCase(),r=(n[i],f["c"](n,["symbol"===Object(rt["a"])(i)?i:i+""]));t.persons=r,ot(e)}}};function st(t){T()(t.name),_.ref("/persons/"+t.name).set(f["a"]({created:Date.now()},t,{updated:Date.now()}))}function ot(t){T()(t.name),_.ref("/persons/"+t.name).set(null)}function lt(t){return Date.now()-t.created>9e5}var ut=1.45,ct=104,dt=1.25,pt=103.63;function mt(t){var e=function(t){return Math.round(Math.max(0,Math.min(255,255*t)))},n=function(t){return t.toString(16).padStart(2,"0")},i=e((t.lat-dt)/(ut-dt)),r=e((t.lng-pt)/(ct-pt)),a=255-Math.max(i,r);return"#"+n(i)+n(r)+n(a)}var ft=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-tooltip",t._g(t._b({attrs:{"content-class":"unobstrustive-disable-mouse"}},"v-tooltip",t.$attrs,!1),t.$listeners),[t._t("default",null,{slot:"activator"}),n("div",[n("div",[n("b",[t._v(t._s(t.value.registrationNumber))])]),n("div",[n("i",[t._v("Status")]),t._v(" "+t._s(t.value.vehicleStatus)+" ")]),n("div",[n("i",[t._v("Location")]),t._v(" "+t._s(t.value.location)+" ")]),n("div",[t._v(" "+t._s(t.sAgo(t.value.created))+" ")])])],2)},ht=[],vt=n("301f"),gt=n.n(vt),Tt=i["default"].extend({props:{value:{}},computed:{sAgo:function(){return function(t){return gt()(new Date(t))}}}}),yt=Tt,bt=n("2877"),wt=Object(bt["a"])(yt,ft,ht,!1,null,null,null),_t=wt.exports,St=i["default"].extend({props:{value:{},placeholder:{type:String,default:""}},computed:{vehiclesById:function(){return this.$store.getters["vehicles/vehiclesById"]},singaporeColors:function(){return function(t){return mt(t)}},stale:function(){return function(t){return lt(t)}}},components:{VehicleTooltip:_t}}),xt=St,Dt=(n("0430"),Object(bt["a"])(xt,nt,it,!1,null,"4aa47725",null)),At=Dt.exports,Et=i["default"].extend({props:{scale:{type:Number,required:!0},teamSchedules:{type:Array,required:!0}},components:{VehicleLabel:At},data:function(){return{dragIndex:-1,isDragging:!1,destinationIndex:0}},methods:{handleMove:function(t){this.$data.destinationIndex=t.draggedContext.futureIndex},handleInput:function(t){this.$store.commit("trips/updateTeams",t)},onDragStart:function(t,e){if(!t.dataTransfer)throw new Error("Unexpected null dataTransfer");t.dataTransfer.effectAllowed="move",t.dataTransfer.dropEffect="move",t.dataTransfer.setData("text/team-reorder-drag","dummy"),this.dragIndex=e,this.isDragging=!0},onDragEnd:function(){this.isDragging=!1,this.dragIndex=-1},onDragOver:function(t,e){if(!t.dataTransfer)throw new Error("Unexpected null dataTransfer");return!t.dataTransfer.types.includes("text/team-reorder-drag")||(t.preventDefault(),t.dataTransfer.dropEffect="move",this.isDragging=!0,this.destinationIndex=e<this.dragIndex?e:e===this.dragIndex?-1:e+1,!1)},onDrop:function(t,e){if(t.preventDefault(),!t.dataTransfer.types.includes("text/team-reorder-drag"))return!0;if(!(this.destinationIndex<0)){var n=this.$store.getters["trips/teamIndexForRow"](this.dragIndex),i=this.$store.getters["trips/teamIndexForRow"](this.destinationIndex);null!==n&&null!==i&&(this.$store.commit("trips/reorderTeam",{oldIndex:n,newIndex:i}),this.isDragging=!1,this.dragIndex=-1)}}}}),Ct=Et,kt=(n("672f"),Object(bt["a"])(Ct,tt,et,!1,null,"6d396108",null)),$t=kt.exports,Lt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div")},Bt=[],Mt=i["default"].extend({mounted:function(){var t=this,e=setInterval((function(){return t.$store.commit("time/updateTime")}),6e4);this.$on("hook:beforeDestroy",(function(){clearInterval(e)}))}}),It=Mt,Pt=Object(bt["a"])(It,Lt,Bt,!1,null,null,null),Ht=Pt.exports,Ot=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"planner-chart",style:{"grid-template-columns":t.yAxisWidth+"px 1fr","grid-template-rows":t.xAxisHeight+"px 1fr"},on:{dragover:function(e){return t.onDragOver(e)},drop:function(e){return t.onDrop(e)},dragleave:function(e){return t.onDragLeave(e)}}},[n("div",{staticClass:"y-axis"},[t._t("y-axis",null,{scale:t.yAxisScale})],2),n("div",{staticClass:"x-axis"},[t._t("x-axis",null,{scale:t.xAxisScale})],2),n("div",{ref:"scrollRef",staticClass:"content"},[t._t("background-svg",null,{xScale:t.xAxisScale,yScale:t.yAxisScale,xAxisHeight:t.xAxisHeight,yAxisWidth:t.yAxisWidth}),t._t("default",null,{xScale:t.xAxisScale,yScale:t.yAxisScale})],2),t.drag.row>=0?n("div",{staticStyle:{border:"dashed 2px rgba(0, 0, 0, 0.5)",position:"absolute","z-index":"10","pointer-events":"none"},style:{top:t.drag.row*t.yAxisScale+t.xAxisHeight+"px",height:t.yAxisScale+"px",left:t.drag.start/36e5*t.xAxisScale+t.yAxisWidth+"px",width:(t.drag.end-t.drag.start)/36e5*t.xAxisScale+"px"}}):t._e(),t.drag.row>=0?n("div",{staticStyle:{"background-color":"#DDD",position:"absolute","pointer-events":"none"},style:{top:t.drag.row*t.yAxisScale+t.xAxisHeight+"px",height:t.yAxisScale+"px",left:t.yAxisWidth+"px",width:24*t.xAxisScale+"px"}}):t._e()])},Nt=[],Rt=null;function Ft(t){Rt=t}function jt(){return Rt}var Vt=i["default"].extend({data:function(){return{scrollLeft:0,scrollTop:0,drag:{row:-1,start:null,end:null,type:null}}},props:{yAxisWidth:{type:Number,default:150},yAxisScale:{type:Number,default:50},xAxisHeight:{type:Number,default:50},xAxisScale:{type:Number,default:50},showTime:{type:Boolean,default:!1}},provide:function(){var t=this;return{xScale:function(){return t.xAxisScale},yScale:function(){return t.yAxisScale}}},methods:{updateScrollOffsets:function(){this.scrollLeft=this.$refs.contentElem.scrollLeft,this.scrollTop=this.$refs.contentElem.scrollTop},scrollTo:function(t,e){this.scrollLeft=this.$refs.contentElem.scrollLeft=t,this.scrollTop=this.$refs.contentElem.scrollTop=e},onDragOver:function(t){var e=jt();if(e){t.preventDefault(),t.dataTransfer.dropEffect="move";var n=e.start,i=e.end,r=Ut(t,this.$refs.scrollRef),a=this.$store.getters["trips/canonicalOffsetForRow"](Math.floor(r/this.yAxisScale));if(null===a)return t.dataTransfer.dropEffect="none",void(this.drag.row=-1);if(a!==e.originalRow)this.drag.type="reassign",this.drag.row=a,this.drag.start=n,this.drag.end=i;else{var s=Wt(t,this.$refs.scrollRef),o=this.xPositionToNearestTick(s-e.offsetX);Math.abs(o-n)>=18e5||"retime"===this.drag.type?(this.drag.type="retime",this.drag.row=a,this.drag.start=o,this.drag.end=o+i-n):this.drag.type=null}}},xPositionToNearestTick:function(t){return Math.round(t/this.xAxisScale*12)/12*36e5},onDrop:function(t){var e=jt();if(e){var n=Ut(t,this.$refs.scrollRef),i=e.tripId,r=(e.start,e.end,Math.floor(n/this.yAxisScale)),a=this.$store.state.trips.trips[i];if(r!==e.originalRow){var s=this.$store.getters["trips/teamForRow"](r);this.$store.getters["tripEditing/tripBeingEdited"];this.$store.commit("trips/reassignJob",{trip:a,team:s})}else if("retime"===this.drag.type){var o=this.drag.start,l=this.drag.end;this.$store.commit("trips/updateTrip",{tripId:a.id,updates:{startTime:o,newEndTime:null===a.endTime?null:l}})}this.drag.type=null,this.drag.row=-1,t.preventDefault()}},onDragLeave:function(t){t.preventDefault()}}});function Wt(t,e){var n=t.offsetX,i=t.target;return n+=i.getBoundingClientRect().left-e.getBoundingClientRect().left,n}function Ut(t,e){var n=t.offsetY,i=t.target;return n+=i.getBoundingClientRect().top-e.getBoundingClientRect().top,n}var Xt=Vt,Kt=(n("20ad"),Object(bt["a"])(Xt,Ot,Nt,!1,null,"686ff501",null)),Gt=Kt.exports,Jt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("g",[t.unassignedTeamData?n("rect",{attrs:{x:"0",width:t.width,y:t.rowHeight*t.unassignedTeamData.first,height:t.rowHeight*(t.unassignedTeamData.last+1-t.unassignedTeamData.first),fill:"#FFDDDD","stroke-dasharray":"4 2"}}):t._e(),t._l(t.teamSchedules,(function(e,i){e[0];var r=e[1];return r.row===r.rowCount-1?n("line",{key:i,attrs:{x1:"0",x2:t.width,y1:(i+1)*t.rowHeight,y2:(i+1)*t.rowHeight,stroke:"#CCCCCC","stroke-dasharray":"4 2"}}):t._e()}))],2)},zt=[],qt=i["default"].extend({props:{rowHeight:{type:Number,required:!0},width:{type:Number,required:!0}},computed:{teamSchedules:function(){return this.$store.getters["trips/teamSchedules"]},unassignedTeamData:function(){for(var t=this.$store.getters["trips/teamSchedules"],e=null,n=null,i=0;i<t.length;i++){var r=f["b"](t[i],2),a=r[0];r[1];a.driver||a.medic||(null===e&&(e=i),n=i)}return null===e?null:{first:e,last:n}}}}),Yt=qt,Qt=Object(bt["a"])(Yt,Jt,zt,!1,null,null,null),Zt=Qt.exports,te=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("g",t._l(t.range,(function(e){return n("line",{key:e,attrs:{y1:"0",y2:t.height,x1:(e+1)*t.columnWidth,x2:(e+1)*t.columnWidth,stroke:"#CCCCCC","stroke-dasharray":"4 2"}})})),0)},ee=[],ne=i["default"].extend({props:{columnWidth:{type:Number,required:!0},n:{type:Number,required:!0},height:{type:Number,required:!0}},computed:{range:function(){return m.a.range(0,this.n)}}}),ie=ne,re=Object(bt["a"])(ie,te,ee,!1,null,null,null),ae=re.exports,se=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("line",{attrs:{y1:"0",y2:t.height,x1:t.time/36e5*t.columnWidth,x2:t.time/36e5*t.columnWidth,stroke:"#FF0000","stroke-width":"2"}})},oe=[],le={namespaced:!0,state:{width:window.innerWidth,scrollTime:0},mutations:{setWidth:function(t,e){t.width=e},setScrollTime:function(t,e){t.scrollTime=e}}},ue=le,ce={namespaced:!0,state:function(){return{time:Date.now()}},getters:{msSinceMidnight:function(t){var e=new Date(t.time);return e.setHours(0,0,0,0),t.time-e.getTime()}},mutations:{updateTime:function(t){t.time=Date.now()}}},de={namespaced:!0,state:function(){return{activeDialog:null,props:{}}},mutations:{showDialogWithProps:function(t,e){var n=e.dialog,i=e.props;t.activeDialog=n,t.props=i},showDialog:function(t,e){t.activeDialog=e},hideDialog:function(t){t.activeDialog=null}}},pe={namespaced:!0,state:function(){return{tripBeingEdited:null}},getters:{tripBeingEdited:function(t,e,n){var i=t.tripBeingEdited;return i?n.trips.trips[i]:null}},mutations:{editTrip:function(t,e){t.tripBeingEdited=e?e.tripId:null}},actions:{updateTripBeingEdited:function(t,e){T()(t.getters.tripBeingEdited,"There is no valid trip being edited"),t.commit("trips/updateTrip",{tripId:t.state.tripBeingEdited,updates:e},{root:!0})},deleteTrip:function(t){t.commit("trips/deleteTrip",{tripId:t.state.tripBeingEdited},{root:!0}),t.commit("tripEditing/editTrip",null,{root:!0})},createAndEditNewTripAtTime:function(t,e){var n={id:v(),driver:e.driver||null,medic:e.medic||null,startTime:e.time,endTime:null,startPostcode:null,endPostcode:null,startAddress:null,endAddress:null,startLocation:null,endLocation:null,startLatLng:null,endLatLng:null,created:Date.now(),updated:Date.now(),isTentative:!1,isReturnTrip:!1,relatedTrip:null,hideFromManifest:!1,description:"New trip $100",cancelled:!1,templateTrip:"",lastSMSTimestamp:null};t.commit("trips/assignNewlyCreatedJob",{trip:n},{root:!0}),t.commit("tripEditing/editTrip",{tripId:n.id},{root:!0})}}},me={namespaced:!0,state:{templates:{}},mutations:{_setTemplates:function(t,e){t.templates=e},_updateTemplate:function(t,e){var n;t.templates=f["a"]({},t.templates,(n={},n[e.id]=e,n))},_deleteTemplate:function(t,e){var n=t.templates,i=e.id,r=(n[i],f["c"](n,["symbol"===Object(rt["a"])(i)?i:i+""]));t.templates=r}},actions:{readTemplates:function(t){return fe().then((function(e){t.commit("_setTemplates",e)}))},updateTemplate:function(t,e){t.rootState.trips.savesDisabled||(t.commit("_updateTemplate",e),he(e))},deleteTemplate:function(t,e){t.rootState.trips.savesDisabled||(t.commit("_deleteTemplate",e),ve(e))}}};function fe(){return _.ref("/templates").once("value").then((function(t){var e=t.val();return m.a.values(e).map((function(t){return{name:t.name||t.id,id:t.id||v(),created:parseFloat(t.created)||Date.now()}})).reduce((function(t,e){return t[e.id]=e,t}),{})}))}function he(t){return T()(t.id),_.ref("/templates/"+t.id).set(t)}function ve(t){return T()(t.id),_.ref("/templates/"+t.id).set(null)}var ge={namespaced:!0,state:function(){return{user:null}},actions:{signInWithPopup:function(t,e){return S.signInWithPopup(e)},signOut:function(t){S.signOut()}},mutations:{updateUser:function(t,e){t.user=e}}},Te=new r["a"].Store({modules:{screen:ue,time:ce,login:ge,trips:k,dialogs:de,vehicles:at,tripEditing:pe,templates:me}});window.addEventListener("resize",(function(){Te.commit("screen/setWidth",window.innerWidth)}));var ye=Te,be=i["default"].extend({computed:{time:function(){var t=new Date(ye.state.time.time),e=new Date(ye.state.time.time);return t.setHours(0,0,0),e.getTime()-t.getTime()}},props:{columnWidth:{type:Number,required:!0},height:{type:Number,required:!0}}}),we=be,_e=Object(bt["a"])(we,se,oe,!1,null,null,null),Se=_e.exports,xe=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"trip-box",style:{left:t.trip.startTime/36e5*t.xScale()+"px",width:t.presumedDuration(t.trip)/36e5*t.xScale()+"px",height:t.yScale()+"px",top:t.yIndexFunction(t.trip)*t.yScale()+"px",opacity:t.trip.cancelled?.5:1,background:t.locationGradient,color:t.trip.latLng?"#FFF":"#000"}},[t.noUpdatesSinceSMS?i("img",{staticClass:"sms-indicator",attrs:{src:n("9afb")}}):t._e(),i("UnobstrusiveTooltip",{staticClass:"trip-box-contents",class:{"is-selected":t.isSelected,"is-tentative":t.trip.isTentative,cancelled:t.trip.cancelled,"hidden-from-manifest":t.trip.hideFromManifest},style:{background:t.locationGradient,color:t.trip.latLng?"#FFF":"#000"},attrs:{top:!0},nativeOn:{click:function(e){return t.$emit("click",e)}}},[i("div",{attrs:{slot:"activator"},slot:"activator"},[t._v(" "+t._s(t.trip.description)+" ")]),i("span",[t._v(" "+t._s(t.trip.description)+" ")])])],1)},De=[],Ae=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-tooltip",t._g(t._b({attrs:{value:t.showTooltip,"content-class":"unobstrustive-disable-mouse"},nativeOn:{mousedown:function(e){t.showTooltip=!1},mouseover:function(e){return t.showTooltipIfMouseNotDown(e)},drag:function(e){t.showTooltip=!1}}},"v-tooltip",t.$attrs,!1),t.$listeners),[t._t("activator",null,{slot:"activator"}),t._t("default")],2)},Ee=[],Ce=i["default"].extend({data:function(){return{showTooltip:!1}},methods:{showTooltipIfMouseNotDown:function(t){t.buttons||(this.showTooltip=!0)}}}),ke=Ce,$e=(n("a09b"),Object(bt["a"])(ke,Ae,Ee,!1,null,null,null)),Le=$e.exports,Be=i["default"].extend({inject:{yScale:{},xScale:{}},props:{isSelected:{type:Boolean},trip:{type:Object,required:!0},yIndexFunction:{type:Function,required:!0}},components:{UnobstrusiveTooltip:Le},data:function(){return{tooltipNeeded:!0}},computed:{singaporeColors:function(){return mt},noUpdatesSinceSMS:function(){var t=this.trip;return null!==t.lastSMSTimestamp&&null!==t.updated&&t.lastSMSTimestamp>t.updated},locationGradient:function(){return this.trip.startLatLng&&this.trip.endLatLng?"linear-gradient(\n          90deg,\n            "+this.singaporeColors(this.trip.startLatLng)+" 20%,\n            "+this.singaporeColors(this.trip.endLatLng)+" 80%\n          )":this.trip.startLatLng?this.singaporeColors(this.trip.startLatLng):this.trip.endLatLng?this.singaporeColors(this.trip.endLatLng):"#CCC"}},methods:{presumedDuration:function(t){return h(t)-t.startTime}}}),Me=Be,Ie=(n("00d9"),Object(bt["a"])(Me,xe,De,!1,null,"2a885415",null)),Pe=Ie.exports,He=function(){var t,e=this,n=e.$createElement,i=e._self._c||n;return e.vehicleData?i("VehicleTooltip",e._b({attrs:{value:e.vehicleData}},"VehicleTooltip",(t={},t[0===e.yIndex?"bottom":"top"]=!0,t),!1),[i("div",{staticClass:"vehicle-marker",class:{stale:e.isStale},style:{left:e.leftPosition,top:e.topPosition,height:e.height,"background-color":e.locationGradient,"border-radius":"1em"}})]):e._e()},Oe=[],Ne=i["default"].extend({inject:{yScale:{},xScale:{}},props:{vehicle:{type:String,required:!0},rowCount:{type:Number,required:!0},yIndex:{type:Number,required:!0}},components:{VehicleTooltip:_t},computed:{singaporeColors:function(){return mt},vehicleData:function(){return ye.getters["vehicles/vehiclesById"][this.vehicle]},timeSinceMidnight:function(){if(this.vehicleData){var t=new Date(this.vehicleData.created);return 36e5*t.getHours()+6e4*t.getMinutes()+1e3*t.getSeconds()}},locationGradient:function(){return this.vehicleData&&this.singaporeColors({lat:this.vehicleData.lat,lng:this.vehicleData.lng})},isStale:function(){if(this.vehicleData)return lt(this.vehicleData)},leftPosition:function(){var t=this.$store.getters["time/msSinceMidnight"],e=Math.min(t+36e5,Math.max(t-36e5,this.timeSinceMidnight||0)),n=e/36e5*this.xScale()+"px";return"calc("+n+" - 0.75em)"},topPosition:function(){var t=this.yIndex*this.yScale()+"px";return"calc("+t+" + 0.25em)"},height:function(){var t=this.rowCount*this.yScale()+"px";return"calc("+t+" - 0.5em)"},sAgo:function(){return function(t){return gt()(new Date(t))}}},methods:{presumedDuration:function(t){return h(t)-t.startTime}}}),Re=Ne,Fe=(n("bed4"),Object(bt["a"])(Re,He,Oe,!1,null,"7a6519c4",null)),je=Fe.exports,Ve=new i["default"]({}),We=.33,Ue=i["default"].extend({name:"app",props:{xAxisScale:{type:Number},yAxisScale:{type:Number}},computed:{_:function(){return m.a},tripKey:function(){return E},chartAreaWidth:function(){return 24*this.xAxisScale},chartAreaHeight:function(){return this.$store.getters["trips/rowCount"]*this.yAxisScale},trips:function(){return this.$store.getters["trips/trips"]},teamSchedules:function(){return this.$store.getters["trips/teamSchedules"]},screenWidth:function(){return this.$store.state.screen.width}},components:{CurrentTime:Se,HorizontalGridLines:Zt,PlannerChart:Gt,TimeUpdater:Ht,TeamList:$t,TripBar:Pe,VehicleMarker:je,VerticalGridLines:ae},watch:{xAxisScale:function(){var t=this;this.$nextTick((function(){t.scrollToCurrentTime()}))}},created:function(){var t=this;Ve.$on("scrollToTime",(function(e){t.scrollToTime(e)}))},methods:{scrollToCurrentTime:function(){var t=this.$store.state.time.time,e=new Date(t);e.setHours(0,0,0,0);var n=new Date(t).getTime()-e.getTime(),i=this.$el.clientWidth,r=n/36e5*this.xAxisScale,a=r-We*i;this.$el.scrollLeft=a},scrollToTime:function(t){var e=this,n=this.$el.clientWidth,i=t/36e5*this.xAxisScale,r=i-We*n,a=function t(n){if(10!=n){var i=r-e.$el.scrollLeft;e.$el.scrollLeft=e.$el.scrollLeft+.3*i,setTimeout((function(){return t(n+1)}),10)}};a(0)},tripClicked:function(t,e){this.$emit("trip-clicked",{tripId:t.id})},onDragStart:function(t,e,n){Ft({start:e.startTime,end:h(e),tripId:e.id,offsetX:t.offsetX,offsetY:t.offsetY,originalRow:n}),t.dataTransfer.setData("text/team-reorder-drag","dummy")},onDragEnd:function(){Ft(null)},createNewTrip:function(t){t.preventDefault();var e=.25*Math.floor(t.offsetX/this.xAxisScale/.25)*36e5,n=Math.floor(t.offsetY/this.yAxisScale),i=this.$store.getters["trips/teamForRow"](n);null!==i&&(e>855e5||this.$store.dispatch("tripEditing/createAndEditNewTripAtTime",f["a"]({time:e},i)))},onScroll:function(t){this.$store.commit("screen/setScrollTime",(this.$el.scrollLeft+We*this.$el.clientWidth)/this.xAxisScale*36e5)}}}),Xe=Ue,Ke=Object(bt["a"])(Xe,Q,Z,!1,null,null,null),Ge=Ke.exports,Je=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.tripBeingEdited?n("div",{key:t.tripBeingEdited.id,staticClass:"trip-editor"},[n("v-card-actions",[n("v-layout",{attrs:{"align-content-end":""}},[n("v-btn",{attrs:{color:"neutral",icon:""},on:{click:t.wantToSendMessage}},[n("v-icon",[t._v("message")])],1),n("v-btn",{attrs:{color:t.historyShown?"primary":"neutral",icon:""},on:{click:function(e){t.historyShown=!t.historyShown}}},[n("v-icon",[t._v("history")])],1),t.hasValidReturnTrip?t._e():n("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[n("v-btn",t._g({attrs:{icon:""}},i),[n("v-icon",[t._v("looks_two")])],1)]}}],null,!1,2148361293)},[n("v-list",[n("v-list-tile",{on:{click:function(e){return t.createReturnTrip(72e5)}}},[t._v(" Return trip in 2hrs ")]),n("v-list-tile",{on:{click:function(e){return t.createReturnTrip(108e5)}}},[t._v(" Return trip in 3hrs ")]),n("v-list-tile",{on:{click:function(e){return t.createReturnTrip(144e5)}}},[t._v(" Return trip in 4hrs ")]),n("v-list-tile",{on:{click:function(e){return t.createReturnTrip(18e6)}}},[t._v(" Return trip in 5hrs ")])],1)],1),n("v-spacer"),n("v-btn",{attrs:{color:"neutral",icon:""},on:{click:function(e){return t.$store.commit("tripEditing/editTrip",null)}}},[n("v-icon",[t._v("close")])],1)],1)],1),n("v-card-text",[t.historyShown?n("MessageHistory",{attrs:{tripId:t.tripBeingEdited.id}}):t._e(),t.hasValidReturnTrip?n("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.visitRelatedTrip(e)}}},[t._v(" "+t._s(t.tripBeingEdited.isReturnTrip?"First trip":"Return trip")+" ")]):t._e(),n("v-textarea",{attrs:{label:"Description",value:t.tripBeingEdited.description,rows:"1","auto-grow":"",disabled:t.tripBeingEdited.cancelled},on:{input:function(e){return t.updateTrip("description",e)}}}),n("TeamsSelect",{attrs:{label:"Assigned to",withNull:!0,value:t.tripKey(t.tripBeingEdited)},on:{input:function(e){return t.reassignTripToTeam(e)}}}),n("PostcodePicker",{attrs:{label:"Start Postcode",value:t.tripBeingEdited.startPostcode,disabled:t.tripBeingEdited.cancelled},on:{input:function(e){return t.updateTrip("startPostcode",e)},"address-found":function(e){t.updateTrip("startLatLng",e.latLng),t.updateTrip("startAddress",e.address)}}}),n("div",{staticStyle:{"border-width":"2px","border-style":"solid",flex:"1 1 auto"},style:{"border-color":t.tripBeingEdited.startLatLng&&t.singaporeColors(t.tripBeingEdited.startLatLng)}},[t._v(" "+t._s(t.tripBeingEdited.startAddress)+" ")]),n("v-text-field",{attrs:{label:"Start Location (Details)",value:t.tripBeingEdited.startLocation,disabled:t.tripBeingEdited.cancelled},on:{input:function(e){return t.updateTrip("startLocation",e)}}}),n("PostcodePicker",{attrs:{label:"End Postcode",value:t.tripBeingEdited.endPostcode,disabled:t.tripBeingEdited.cancelled},on:{input:function(e){return t.updateTrip("endPostcode",e)},"address-found":function(e){t.updateTrip("endLatLng",e.latLng),t.updateTrip("endAddress",e.address)}}}),n("div",{staticStyle:{"border-width":"2px","border-style":"solid",flex:"1 1 auto"},style:{"border-color":t.tripBeingEdited.endLatLng&&t.singaporeColors(t.tripBeingEdited.endLatLng)}},[t._v(" "+t._s(t.tripBeingEdited.endAddress)+" ")]),n("v-text-field",{attrs:{label:"End Location (Details)",value:t.tripBeingEdited.endLocation,disabled:t.tripBeingEdited.cancelled},on:{input:function(e){return t.updateTrip("endLocation",e)}}}),n("TimeEditor",{attrs:{label:"Start Time",value:t.tripBeingEdited.startTime,disabled:t.tripBeingEdited.cancelled},on:{input:function(e){return t.updateTrip("startTime",e)}}}),n("TimeEditor",{attrs:{label:"End Time",value:t.tripBeingEdited.endTime,disabled:t.tripBeingEdited.cancelled},on:{input:function(e){return t.updateTrip("endTime",null===e?null:e<t.tripBeingEdited.startTime?e+864e5:e)}}}),n("v-checkbox",{attrs:{"input-value":t.tripBeingEdited.isTentative,label:"Timing is tentative"},on:{change:function(e){return t.updateTrip("isTentative",e)}}}),n("v-checkbox",{attrs:{"input-value":t.tripBeingEdited.hideFromManifest,label:"Hide from manifest"},on:{change:function(e){return t.updateTrip("hideFromManifest",e)}}}),n("hr"),n("hr"),n("v-layout",[n("v-spacer"),t.deleteAllowed?n("v-btn",{attrs:{color:"error"},on:{click:function(e){return t.$store.dispatch("tripEditing/deleteTrip")}}},[t._v(" Delete ")]):n("v-btn",{attrs:{color:"error"},on:{click:function(e){return t.updateTrip("cancelled",!t.tripBeingEdited.cancelled)}}},[t._v(" "+t._s(t.tripBeingEdited.cancelled?"Restore trip":"Cancel trip")+" ")])],1)],1)],1):t._e()},ze=[],qe=(n("a15b"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-input",t._b({},"v-input",t._.omit(t.$attrs,["value"]),!1),[n("input",t._g({staticStyle:{width:"5em"},attrs:{type:"tel"},domProps:{value:t.convertFromTime(t.value)},on:{change:function(e){t.$emit("input",t.convertToTime(e.target.value))}}},t._.omit(t.$listeners,["input","change"])))])}),Ye=[],Qe=(n("466d"),/^([0-9]?[0-9]):?([0-9][0-9])$/),Ze=i["default"].extend({props:["value"],computed:{_:function(){return m.a}},methods:{convertFromTime:function(t){if(null===t)return"";var e=parseInt((t/36e5).toString()).toString().padStart(2," "),n=parseInt((t%36e5/6e4).toString()).toString().padStart(2,"0");return e+":"+n},convertToTime:function(t){var e=t.match(Qe);return e?36e5*parseInt(e[1],10)+6e4*parseInt(e[2],10):null}}}),tn=Ze,en=Object(bt["a"])(tn,qe,Ye,!1,null,null,null),nn=en.exports,rn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-select",t._g(t._b({attrs:{items:t.teams,"item-text":function(t){return t.driver&&t.medic?t.driver+", "+t.medic:"(Not assigned)"},"item-value":t.tripKey,value:t.value}},"v-select",t.$attrs,!1),t.$listeners))},an=[],sn=i["default"].extend({props:["value","withNull"],computed:{tripKey:function(){return E},teams:function(){var t=E({driver:null,medic:null});return!this.withNull||t in this.$store.state.trips.scheduleByTeam?this.$store.state.trips.teams:[{driver:null,medic:null}].concat(this.$store.state.trips.teams)}}}),on=sn,ln=Object(bt["a"])(on,rn,an,!1,null,null,null),un=ln.exports,cn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-text-field",t._b({attrs:{label:t.label,value:t.value},on:{blur:t.maybeEmitPostcode,input:t.updateQuery}},"v-text-field",t.$attrs,!1))},dn=[],pn={NTF:"609606",NTFGH:"609606",KTPH:"768828",SGH:"169608",CGH:"529889",TTSH:"308433",SKH:"544835",AH:"159964",NUH:"119073",IMH:"539747",KKH:"229899"},mn=function(t){if(t.results&&t.results.length>0){var e=m.a.minBy(t.results,(function(t){return["NIL"===t.POSTAL,t.ADDRESS.length]}));return{address:e.ADDRESS.toLowerCase().replace(/(?:\b|^)[a-z]/g,(function(t){return t.toUpperCase()})),latLng:{lat:parseFloat(e.LATITUDE),lng:parseFloat(e.LONGITUDE)},postalCode:"NIL"!==e.POSTAL?e.POSTAL:null}}return null};function fn(t){if(!t)return Promise.resolve(null);var e=t.toUpperCase();if(e in pn)return fetch("https://developers.onemap.sg/commonapi/search?"+z.a.stringify({searchVal:pn[e],returnGeom:"Y",getAddrDetails:"Y",pageNum:1})).then((function(t){return t.json()})).then((function(t){return mn(t)})).then((function(t){return t&&f["a"]({},t,{address:e,postalCode:pn[e]})}));var n=fetch("https://developers.onemap.sg/commonapi/search?"+z.a.stringify({searchVal:t,returnGeom:"Y",getAddrDetails:"Y",pageNum:1})).then((function(t){return t.json()})).then((function(t){return mn(t)}));return n}var hn=i["default"].extend({props:{value:{type:String},label:{type:String}},data:function(){return{lastKnownPostcode:null}},mounted:function(){},methods:{updateQuery:function(t){this.$emit("input",t);var e=this.$updateQueryDebounced||m.a.debounce(this.updateQueryImpl,200);e()},updateQueryImpl:function(){var t=this.value||"";t?this.triggerOneMapSearch():(this.$emit("address-found",{address:null,latLng:null}),this.lastKnownPostcode=null)},maybeEmitPostcode:function(){var t=this;this.$updateQueryDebounced&&this.$updateQueryDebounced.cancel(),this.triggerOneMapSearch().then((function(){t.lastKnownPostcode&&t.value!==t.lastKnownPostcode&&t.$emit("input",t.lastKnownPostcode)}))},triggerOneMapSearch:function(){var t=this,e=this.$oneMapPromise=fn(this.value).then((function(n){e===t.$oneMapPromise&&(null===n?(t.$emit("address-found",{address:"(not found)",latLng:null}),t.lastKnownPostcode=null):(t.$emit("address-found",n),t.lastKnownPostcode=n.postalCode))}));return e}}}),vn=hn,gn=Object(bt["a"])(vn,cn,dn,!1,null,null,null),Tn=gn.exports,yn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"message-history"},["loading"===t.state?[t._v(" Loading... ")]:[0===t.messages.length?[t._v(" No messages in history ")]:t._e(),t._l(t.messages,(function(e){return n("div",{staticClass:"message"},[n("b",[t._v(t._s(t.formatDate(e.created))+"; "+t._s(e.recipients.join(", "))+">")]),t._v(" "+t._s(e.message)+" ")])}))]],2)},bn=[];n("4fad"),n("1276");function wn(t){var e=t.val();return m.a.orderBy(Object.entries(e||{}),(function(t){return t[1].created}),"desc").map((function(t){var e=f["b"](t,2),n=e[0],i=e[1],r=i;return{id:r.id||n,recipients:(r.recipients||"").split(/,/g).filter(Boolean),message:r.message||"",status:r.status||"",trip:r.trip||null,created:r.created||null}}))}var _n=function(){function t(t){this.db=t}return t.prototype.createMessage=function(t){var e=v();this.db.ref("/sms/"+e).update({id:e,recipients:t.recipients.join(","),message:t.message,trip:t.trip,created:Date.now(),status:"unsent"})},t}(),Sn=i["default"].extend({props:["tripId"],data:function(){return{state:"loading",messages:[]}},watch:{tripId:function(t){t?(this.state="loading",this.loadByTripId(t)):(this.state="done",this.messages=[])}},mounted:function(){this.loadByTripId(this.tripId)},methods:{formatDate:function(t){return D()(t,"dd-mmm-yy HH:MM")},loadByTripId:function(t){var e=this,n=this.$inflightPromise=_.ref("/sms").orderByChild("trip").equalTo(t).once("value").then((function(t){n===e.$inflightPromise&&(e.state="done",e.messages=wn(t))}))}}}),xn=Sn,Dn=(n("5a95"),Object(bt["a"])(xn,yn,bn,!1,null,"28672314",null)),An=Dn.exports,En=i["default"].extend({components:{TimeEditor:nn,PostcodePicker:Tn,TeamsSelect:un,MessageHistory:An},data:function(){return{historyShown:!1}},computed:{tripBeingEdited:function(){return this.$store.getters["tripEditing/tripBeingEdited"]},tripKey:function(){return E},singaporeColors:function(){return mt},deleteAllowed:function(){if("template"===this.$store.state.trips.mode.type)return!0;var t=this.$store.state.time.time;return t-this.tripBeingEdited.created<9e5},hasValidReturnTrip:function(){var t=this.tripBeingEdited.relatedTrip;return!(!t||!this.$store.state.trips.trips[t])},message:function(){var t=this.tripBeingEdited,e=function(t){return t.replace(/\bSINGAPORE ([0-9]{6})\b/gi,(function(t,e){return"S("+e+")"})).replace(/\bstreet\b/gi,"St").replace(/\broad\b/gi,"Rd").replace(/\bbukit\b/gi,"Bt").replace(/\btanjong\b/gi,"Tg").replace(/\bjalan\b/gi,"Jln").replace(/\blorong\b/gi,"Lor").replace(/\bavenue\b/gi,"Ave").replace(/\bboulevard\b/gi,"Blvd").replace(/\bsingapore\b/gi,"sgp")},n=function(t){return t.trim().replace(/\s+/g," ")},i=function(t){return t.replace(/\s*\n\s+/g,"\n")},r=t.description||"",a=t.cancelled?"(cancelled)":"",s=e("\n        "+(t.startAddress||"")+" "+(t.startLocation||"")+"\n      "),o=e("\n        "+(t.endAddress||"")+" "+(t.endLocation||"")+"\n      "),l=function(t){return D()(t,"HH:MM",!0)},u=l(t.startTime),c=[t.driver,t.medic].filter((function(t){return Boolean(t)})).join("/"),d=t.relatedTrip&&this.$store.state.trips.trips[t.relatedTrip],p=t.isReturnTrip&&d?"1st trip: "+[d.driver,d.medic].filter(Boolean).join("+")+" @"+l(d.startTime):"";return i("\n      "+c+":\n      "+n(r)+" "+a+"\n      "+s+" - "+o+"\n      @"+u+"\n      "+p+"\n      ").trim()},messageLabel:function(){return"Message ("+this.message.length+" chars)"},tripRecipientPhoneNumbers:function(){var t=this.tripBeingEdited.driver,e=this.tripBeingEdited.medic,n=t&&this.$store.state.vehicles.persons[t.toLowerCase()],i=e&&this.$store.state.vehicles.persons[e.toLowerCase()];return[n,i]}},methods:{updateTrip:function(t,e){var n;this.$store.dispatch("tripEditing/updateTripBeingEdited",(n={},n[t]=e,n))},reassignTripToTeam:function(t){var e=t===C?{driver:null,medic:null}:this.$store.state.trips.teams.find((function(e){return E(e)===t}));this.$store.commit("trips/reassignJob",{trip:this.tripBeingEdited,team:e}),this.$store.commit("tripEditing/editTrip",{tripId:this.tripBeingEdited.id})},createReturnTrip:function(t){var e=v(),n=f["a"]({},this.tripBeingEdited,{id:e,description:"[Ret] "+(this.tripBeingEdited.description||""),created:Date.now(),startTime:this.tripBeingEdited.startTime+t,endTime:null===this.tripBeingEdited.endTime?null:this.tripBeingEdited.endTime+t,startAddress:this.tripBeingEdited.endAddress,startLocation:this.tripBeingEdited.endLocation,startLatLng:this.tripBeingEdited.endLatLng,startPostcode:this.tripBeingEdited.endPostcode,endAddress:this.tripBeingEdited.startAddress,endLocation:this.tripBeingEdited.startLocation,endLatLng:this.tripBeingEdited.startLatLng,endPostcode:this.tripBeingEdited.startPostcode,relatedTrip:this.tripBeingEdited.id,isReturnTrip:!0,isTentative:!0});this.$store.commit("trips/assignNewlyCreatedJob",{trip:n}),this.updateTrip("relatedTrip",e)},visitRelatedTrip:function(){var t=this.tripBeingEdited.relatedTrip,e=t&&this.$store.state.trips.trips[t];e?(this.$store.commit("tripEditing/editTrip",{tripId:t}),Ve.$emit("scrollToTime",e.startTime)):this.updateTrip("relatedTrip",null)},wantToSendMessage:function(){this.$store.commit("dialogs/showDialogWithProps",{dialog:"draftMessage",props:{recipients:this.tripRecipientPhoneNumbers.filter((function(t){return t})).map((function(t){return t&&t.telephone})),message:this.message,trip:this.tripBeingEdited.id}})}}}),Cn=En,kn=(n("a676"),Object(bt["a"])(Cn,Je,ze,!1,null,"07841563",null)),$n=kn.exports,Ln=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[n("v-text-field",t._g({staticStyle:{flex:"0 0 150px"},attrs:{value:t.timestampText,label:"Date:",readonly:""}},i))]}}]),model:{value:t.isOpen,callback:function(e){t.isOpen=e},expression:"isOpen"}},[n("v-date-picker",{attrs:{value:t.timestampISO},on:{input:t.handleDateInput}})],1)},Bn=[],Mn={data:function(){return{isOpen:!1}},computed:{timestampText:function(){var t=ye.state.trips.mode;if("date"===t.type)return D()(t.timestamp,"ddd, dd mmm yyyy")},timestampISO:function(){var t=ye.state.trips.mode;if("date"===t.type)return D()(t.timestamp,"yyyy-mm-dd")}},methods:{handleDateInput:function(t){ye.dispatch("trips/setMode",{type:"date",timestamp:new Date(t+"T00:00:00+0800").getTime()})}}},In=Mn,Pn=Object(bt["a"])(In,Ln,Bn,!1,null,null,null),Hn=Pn.exports,On=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"print-area"},[n("ManifestComponent",{attrs:{showHiddenTrips:!1}})],1)},Nn=[],Rn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("table",{staticClass:"manifest-table"},[t._m(0),n("tbody",t._l(t.trips,(function(e){return t.showHiddenTrips||!e.hideFromManifest?n("tr",{key:e.id,class:{cancelled:e.cancelled,"hidden-from-manifest":t.showHiddenTrips&&e.hideFromManifest}},[n("td",[t._v(t._s(e.driver)+", "+t._s(e.medic))]),n("td",[t._v(t._s(t.dateformat(e.startTime,"HH:MM",!0)))]),n("td",[t._v(t._s(e.endTime&&t.dateformat(e.endTime,"HH:MM",!0)))]),n("td",[n("div",[t._v(t._s(e.description))]),e.startAddress||e.startLocation?n("div",[n("b",[t._v("From: ")]),t._v(t._s(e.startAddress)+" "+t._s(e.startLocation))]):t._e(),e.endAddress||e.endLocation?n("div",[n("b",[t._v("To: ")]),t._v(t._s(e.endAddress)+" "+t._s(e.endLocation)+" ")]):t._e()])]):t._e()})),0)])},Fn=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("thead",[n("tr",[n("th",[t._v("Team")]),n("th",[t._v("Start")]),n("th",[t._v("End")]),n("th",[t._v("Description")])])])}],jn=i["default"].extend({props:["showHiddenTrips"],computed:{dateformat:function(){return D.a},trips:function(){var t=m.a.flatMap(this.$store.getters["trips/teamSchedules"],(function(t){return t[1].trips}));return m.a.sortBy(t,(function(t){return t.startTime}))}}}),Vn=jn,Wn=(n("4801"),Object(bt["a"])(Vn,Rn,Fn,!1,null,"31069700",null)),Un=Wn.exports,Xn=i["default"].extend({components:{ManifestComponent:Un}}),Kn=Xn,Gn=(n("defd"),Object(bt["a"])(Kn,On,Nn,!1,null,null,null)),Jn=Gn.exports,zn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("StandardDialog",{attrs:{title:"Manage teams",name:"teams",height:"80vh"}},[n("v-btn",{on:{click:function(e){return t.$store.commit("dialogs/showDialog","importTeams")}}},[t._v(" Import from a previous day ")]),t._l(t.teams,(function(e,i){return n("div",{key:e.driver+","+e.medic,ref:"teamsGrid",refInFor:!0,attrs:{"data-key":e.driver+","+e.medic}},[n("div",{staticClass:"teams-grid"},[n("div",{staticClass:"action"},[t.teamHasTrips(e)?t._e():n("span",{staticStyle:{cursor:"pointer"},on:{click:function(e){return t.dropTeam(i)}}},[n("v-icon",[t._v("delete")])],1)]),n("EditingCell",{staticClass:"cell",attrs:{disabled:t.teamHasTrips(e)},scopedSlots:t._u([{key:"editor",fn:function(r){return[n("EditingDropdown",{attrs:{items:t.staffList,value:e.driver},on:{blur:function(t){return r.blur()},input:function(e){return t.updateTeam(i,e,"driver")}}})]}}],null,!0)},[n("PersonView",{attrs:{value:e.driver,placeholder:"(Driver)"}})],1),n("EditingCell",{staticClass:"cell",attrs:{disabled:t.teamHasTrips(e)},scopedSlots:t._u([{key:"editor",fn:function(r){return[n("EditingDropdown",{attrs:{items:t.staffList,value:e.medic},on:{blur:function(t){return r.blur()},input:function(e){return t.updateTeam(i,e,"medic")}}})]}}],null,!0)},[n("PersonView",{attrs:{value:e.medic,placeholder:"(Medic)"}})],1),n("EditingCell",{staticClass:"cell",scopedSlots:t._u([{key:"editor",fn:function(r){return[n("EditingDropdown",{attrs:{items:t.$store.state.vehicles.vehicles.map((function(t){return t.registrationNumber})),value:e.vehicle},on:{blur:function(t){return r.blur()},input:function(e){return t.updateTeam(i,e,"vehicle")}}})]}}],null,!0)},[n("VehicleView",{attrs:{value:e.vehicle,placeholder:"(No vehicle)"}})],1)],1),t.errors[i]?n("v-alert",{attrs:{value:!0,type:"error"}},[t._v(" "+t._s(t.errors[i])+" ")]):t._e()],1)})),n("div",{staticClass:"teams-grid"},[n("div",{staticClass:"action"},[t._v(" (New) ")]),n("EditingCell",{staticClass:"cell",scopedSlots:t._u([{key:"editor",fn:function(e){return[n("EditingDropdown",{attrs:{items:t.staffList},on:{input:function(e){t.newTeam.driver=e},blur:function(t){return e.blur()}}})]}}])},[n("PersonView",{attrs:{value:t.newTeam.driver,placeholder:"(Driver)"}})],1),n("EditingCell",{staticClass:"cell",scopedSlots:t._u([{key:"editor",fn:function(e){return[n("EditingDropdown",{attrs:{items:t.staffList,value:t.newTeam.medic},on:{input:function(e){t.newTeam.medic=e},blur:function(t){return e.blur()}}})]}}])},[n("PersonView",{attrs:{value:t.newTeam.medic,placeholder:"(Driver)"}})],1),n("EditingCell",{staticClass:"cell",attrs:{disabled:!0},nativeOn:{focus:function(e){return t.maybeCreateTeam(e)}},scopedSlots:t._u([{key:"editor",fn:function(t){}}])},[n("span",{staticClass:"placeholder"},[t._v("(Vehicle)")])])],1),t.errors["new"]?n("v-alert",{attrs:{value:!0,type:"error"}},[t._v(" "+t._s(t.errors["new"])+" ")]):t._e()],2)},qn=[],Yn=(n("fb6a"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.isEditing?n("div",{ref:"editorDiv",staticClass:"editor-div"},[t._t("editor",null,{blur:t.blur})],2):n("div",{class:{disabled:t.disabled},attrs:{tabindex:"0"},on:{focus:function(e){return t.handleFocus()},click:function(e){return e.preventDefault(),t.handleFocus()}}},[t._t("default")],2)}),Qn=[],Zn=i["default"].extend({props:{disabled:{type:Boolean,default:!1}},data:function(){return{isEditing:!1}},watch:{isEditing:function(t){var e=this;this.$nextTick((function(){var n=e.$refs.editorDiv,i=n&&n.querySelector("input, a, select");i&&t&&setTimeout((function(){return i.select()}),1)}))}},methods:{blur:function(){var t=this;this.$nextTick((function(){t.isEditing=!1}))},handleFocus:function(){this.disabled||(this.isEditing=!0)}}}),ti=Zn,ei=(n("6a26"),Object(bt["a"])(ti,Yn,Qn,!1,null,"46fffcd8",null)),ni=ei.exports,ii=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.value?n("span",[t._v(" "+t._s(t.value)+" "),t.persons[t.value.toLowerCase()]?n("span",{staticClass:"telephone"},[t._v(" "+t._s(t.persons[t.value.toLowerCase()].telephone)+" ")]):t._e()]):n("span",{staticClass:"placeholder"},[t._v(" "+t._s(t.placeholder)+" ")])},ri=[],ai=i["default"].extend({props:{value:{},placeholder:{type:String,default:""}},computed:{persons:function(){return this.$store.state.vehicles.persons}}}),si=ai,oi=(n("ad04"),Object(bt["a"])(si,ii,ri,!1,null,"f8c2c1e6",null)),li=oi.exports,ui=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.value&&t.vehiclesById[t.value]?n("span",[n("VehicleLabel",{attrs:{value:t.value,bottom:""}},[n("template",{slot:"before"},[t._v(t._s(t.value)+" ")])],2)],1):t.value?n("span",[t._v(" "+t._s(t.value)+" ")]):n("span",{staticClass:"placeholder"},[t._v(" "+t._s(t.placeholder)+" ")])},ci=[],di=i["default"].extend({props:{value:{},placeholder:{type:String,default:""}},computed:{vehiclesById:function(){return this.$store.getters["vehicles/vehiclesById"]}},components:{VehicleLabel:At}}),pi=di,mi=Object(bt["a"])(pi,ui,ci,!1,null,null,null),fi=mi.exports,hi=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-menu",{attrs:{"offset-y":"",bottom:"","allow-overflow":"",value:t.showMenu,"close-on-click":!1,"close-on-content-click":!1},scopedSlots:t._u([{key:"activator",fn:function(e){return[n("v-layout",{ref:"inputParent",staticClass:"layout"},[n("input",t._b({directives:[{name:"model",rawName:"v-model",value:t.searchInput,expression:"searchInput"}],ref:"myinput",attrs:{type:"text"},domProps:{value:t.searchInput},on:{input:[function(e){e.target.composing||(t.searchInput=e.target.value)},t.handleShowMenu],blur:t.handleBlur,focus:t.handleFocus,keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"down",40,e.key,["Down","ArrowDown"])?null:t.selectNext(e)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"down",40,e.key,["Down","ArrowDown"])?null:e.altKey?t.handleShowMenu(e):null},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"up",38,e.key,["Up","ArrowUp"])?null:t.selectPrev(e)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.selectCurrent(e)},function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"]))return null;t.showMenu=!1}]}},"input",t.$attrs,!1)),n("v-icon",{staticClass:"menu-chevron",attrs:{tabindex:"-1"},nativeOn:{click:function(e){return t.handleShowMenu(e)}}},[t._v("expand_more")])],1)]}}])},[n("v-list",{ref:"selectionItems",staticClass:"list",attrs:{tabindex:"-1"}},t._l(t.listItems,(function(e){return n("div",{key:e.value,staticClass:"list-tile",class:{active:t.isSelected(e)},on:{click:function(n){return n.preventDefault(),t.handleClick(e)}}},[t._v(" "+t._s(e.value)+" ")])})),0)],1)},vi=[],gi=(n("c975"),i["default"].extend({props:{items:{},value:{}},computed:{listItems:function(){var t=this,e=this.searchInput,n=(e||"").toLowerCase(),i=this.lowerCaseItems.map((function(t,e){return[t,e]})).filter((function(t){var e=f["b"](t,2),i=e[0];e[1];return!n||-1!==i.indexOf(n)})).map((function(e){var n=f["b"](e,2),i=(n[0],n[1]);return{text:t.items[i],value:t.items[i]}}));return n in this.itemsByValue?i:i.concat([{text:e||"",value:e||""}])},lowerCaseItems:function(){return this.items.map((function(t){return t.toLowerCase()}))},itemsByValue:function(){return m.a.keyBy(this.lowerCaseItems,(function(t){return t}))}},data:function(){return{searchInput:null,showMenu:!1,selection:-1,blurTimeout:null}},mounted:function(){var t=this;this.$watch("value",(function(e){t.searchInput=t.value}),{immediate:!0}),this.$watch("listItems",(function(e){t.selection=-1})),this.$watch("selection",(function(e){var n=t.$refs.selectionItems.$el.children[e];n&&n.parentElement.scrollTo(0,n.offsetTop)}))},methods:{handleClick:function(t){var e=this;this.handleSelect(t),this.focusBack(),setTimeout((function(){e.focusBack()}),1)},handleSelect:function(t){console.log("handleSelect"),this.$emit("input",t.value),this.showMenu=!1,this.searchInput=t.text,this.selection=-1},handleBlur:function(t){var e=this,n=t.relatedTarget;n&&n instanceof HTMLElement&&(Ti(n,this.$refs.inputParent)||Ti(n,this.$refs.selectionItems.$el))||(console.log("handleBlur",t.relatedTarget),this.blurTimeout=setTimeout((function(){console.log("blurTimeout"),e.$emit("input",(-1!==e.selection&&e.listItems[e.selection].value||e.searchInput||"").trim()||null),e.showMenu=!1,e.blurTimeout=null,e.$emit("blur")}),1))},handleFocus:function(t){null!==this.blurTimeout&&(clearTimeout(this.blurTimeout),this.blurTimeout=null)},handleShowMenu:function(){var t=this;this.showMenu=!0,this.focusBack(),setTimeout((function(){t.focusBack()}),1)},focusBack:function(){this.handleFocus(),this.$refs.myinput.focus()},selectNext:function(){this.selection<this.listItems.length-1&&(this.selection+=1)},selectPrev:function(){this.selection>0&&(this.selection-=1)},selectCurrent:function(t){t.preventDefault(),this.selection<this.listItems.length&&this.selection>=0&&(this.handleSelect(this.listItems[this.selection]),this.focusBack())},isSelected:function(t){return this.listItems[this.selection]===t},notify:function(t){}}}));function Ti(t,e){var n=t;while(n){if(n===e)return!0;n=n.parentElement}return!1}var yi=gi,bi=(n("4b77"),Object(bt["a"])(yi,hi,vi,!1,null,"42201d8d",null)),wi=bi.exports,_i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-dialog",{attrs:{value:t.$store.state.dialogs.activeDialog===t.name,scrollable:""},on:{input:t.handleDialogInput}},[n("v-card",[n("v-card-title",[n("v-layout",[n("h2",[t._v(t._s(t.title))]),t._t("header"),n("v-spacer"),n("v-btn",{attrs:{small:"",icon:""},on:{click:t.handleDialogInput}},[n("v-icon",[t._v("close")])],1)],2)],1),n("v-card-text",{style:t.height?{height:t.height}:{}},[t._t("default")],2)],1)],1)},Si=[],xi=i["default"].extend({props:{name:{type:String,required:!0},title:{type:String,required:!1},height:{type:String,required:!1}},methods:{handleDialogInput:function(){this.$store.commit("dialogs/hideDialog")}}}),Di=xi,Ai=Object(bt["a"])(Di,_i,Si,!1,null,null,null),Ei=Ai.exports,Ci=i["default"].extend({data:function(){return{defaultList:[],newTeam:{driver:null,medic:null,vehicle:null},errors:{}}},components:{EditingCell:ni,EditingDropdown:wi,PersonView:li,StandardDialog:Ei,VehicleView:fi},computed:{vehicles:function(){return ye.state.vehicles.vehicles},teams:function(){return ye.state.trips.teams||[]},staffList:function(){return m.a.sortBy(this.$store.getters["vehicles/personArray"].map((function(t){return t.name})))},scheduleByTeam:function(){return ye.state.trips.scheduleByTeam}},methods:{handleDialogInput:function(t){t||ye.commit("dialogs/hideDialog")},handleMemberDrag:function(t,e){if(!t.dataTransfer)throw new Error("Unexpected null dataTransfer");t.dataTransfer.effectAllowed="move",t.dataTransfer.dropEffect="move",t.dataTransfer.setData("text/member-drag",e)},handleVehicleDrag:function(t,e){if(!t.dataTransfer)throw new Error("Unexpected null dataTransfer");t.dataTransfer.effectAllowed="move",t.dataTransfer.dropEffect="move",t.dataTransfer.setData("text/vehicle-drag",e)},createNewTeam:function(t,e){ye.commit("trips/updateTeams",this.teams.concat([{driver:"driver"==e?t:null,medic:"medic"==e?t:null,vehicle:"vehicle"==e?t:null}]))},updateTeam:function(t,e,n){var i,r=this.teams[t];T()(r);var a=f["a"]({},r,(i={},i[n]=e,i));if(this.teamExists(t,a))return this.flashError(t,"This team ("+a.driver+", "+a.medic+") already exists");ye.commit("trips/updateTeams",this.teams.slice(0,t).concat([a]).concat(this.teams.slice(t+1)))},dropTeam:function(t){ye.commit("trips/updateTeams",this.teams.slice(0,t).concat(this.teams.slice(t+1)))},teamHasTrips:function(t){return m.a.sum(this.scheduleByTeam[E(t)].rows.map((function(t){return t.length})))>0},teamExists:function(t,e){return!!this.teams.find((function(n,i){return i!==t&&E(e)===E(n)}))},flashError:function(t,e){var n,i=this;this.errors=f["a"]({},this.errors,(n={},n[t.toString()]=e,n)),setTimeout((function(){if(i.errors[t.toString()]===e){var n=i.errors,r=t.toString(),a=(n[r],f["c"](n,["symbol"===Object(rt["a"])(r)?r:r+""]));i.errors=a}}),4e3)},maybeCreateTeam:function(){var t=this;(this.newTeam.driver||this.newTeam.medic)&&setTimeout((function(){var e=t.newTeam,n=e.driver,i=e.medic;if(t.teamExists(null,t.newTeam))return t.flashError("new","This team ("+n+", "+i+") already exists");ye.commit("trips/updateTeams",t.teams.concat([{driver:n,medic:i,vehicle:null}])),t.newTeam={driver:null,medic:null,vehicle:null},t.$nextTick((function(){var e=n+","+i,r=t.$refs.teamsGrid.find((function(t){return t.dataset.key===e})),a=r&&f["d"](r.querySelectorAll(".cell"));a&&a[a.length-1].focus()}))}),1)}}}),ki=Ci,$i=(n("1adb"),Object(bt["a"])(ki,zn,qn,!1,null,"cae8e4be",null)),Li=$i.exports,Bi=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("StandardDialog",{attrs:{name:"persons",title:"Manage people"}},[n("div",{staticClass:"persons-grid"},[n("div",{staticClass:"action"}),n("div",{staticClass:"cell"},[n("strong",[t._v("Name")])]),n("div",{staticClass:"cell"},[n("strong",[t._v("Telephone number")])]),n("div",{staticClass:"cell"},[n("strong",[t._v("Last updated")])])]),t._l(t.personList,(function(e,i){return n("div",{key:i,ref:"personsGrid",refInFor:!0,attrs:{"data-key":e.name}},[n("div",{staticClass:"persons-grid"},[n("div",{staticClass:"action"},[n("span",{on:{click:function(n){return t.dropPerson(e)}}},[n("v-icon",[t._v("delete")])],1)]),n("EditingCell",{staticClass:"cell",attrs:{disabled:!0}},[t._v(" "+t._s(e.name)+" ")]),n("EditingCell",{staticClass:"cell",scopedSlots:t._u([{key:"editor",fn:function(r){return[n("EditingTextField",{attrs:{value:e.telephone},on:{change:function(e){return t.updatePerson(i,e,"telephone")},blur:function(t){return r.blur()}}})]}}],null,!0)},[e.telephone?[t._v(" "+t._s(e.telephone)+" ")]:n("span",{staticClass:"placeholder"},[t._v("(No telephone)")])],2),n("EditingCell",{staticClass:"cell",attrs:{disabled:!0}},[t._v(" "+t._s(e.updated&&t.sAgo(e.updated,"DD MMM YYYY, hh:mm:ss"))+" ")])],1),t.errors[i]?n("v-alert",{attrs:{value:!0,type:"error"}},[t._v(" "+t._s(t.errors[i])+" ")]):t._e()],1)})),n("div",{staticClass:"persons-grid"},[n("div",{staticClass:"action"},[t._v(" (New) ")]),n("EditingCell",{staticClass:"cell",scopedSlots:t._u([{key:"editor",fn:function(e){return[n("EditingTextField",{on:{change:t.maybeCreatePerson,blur:function(t){return e.blur()}},model:{value:t.newPerson.name,callback:function(e){t.$set(t.newPerson,"name",e)},expression:"newPerson.name"}})]}}])},[t.newPerson.name?[t._v(" "+t._s(t.newPerson.name)+" ")]:n("span",{staticClass:"placeholder"},[t._v("(Name)")])],2),n("EditingCell",{staticClass:"cell"}),n("EditingCell",{staticClass:"cell"})],1),t.errors["new"]?n("v-alert",{attrs:{value:!0,type:"error"}},[t._v(" "+t._s(t.errors["new"])+" ")]):t._e()],2)},Mi=[],Ii=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("input",t._g(t._b({ref:"myinput",on:{input:function(e){return t.$emit("input",e.target.value)},change:function(e){return t.$emit("change",e.target.value)}}},"input",t.$attrs,!1),t.unhandledListeners))},Pi=[],Hi=i["default"].extend({computed:{unhandledListeners:function(){var t=this.$listeners,e=(t.change,t.input,f["c"](t,["change","input"]));return e}}}),Oi=Hi,Ni=(n("677e"),Object(bt["a"])(Oi,Ii,Pi,!1,null,"32b07e69",null)),Ri=Ni.exports,Fi=i["default"].extend({data:function(){return{reference:Date.now(),newPerson:{name:null,telephone:null},errors:{}}},components:{EditingCell:ni,EditingTextField:Ri,PersonView:li,StandardDialog:Ei},computed:{sAgo:function(){return function(t){return gt()(new Date(t))}},personList:function(){var t=this;return m.a.sortBy(ye.getters["vehicles/personArray"],(function(e){return e.created<t.reference?[0,e.name,null]:[1,null,-e.created]}))},personByLowercaseKey:function(){return m.a.keyBy(ye.getters["vehicles/personArray"],(function(t){return t.name.toLowerCase()}))}},watch:{dialogShown:function(){this.reference=Date.now()}},methods:{handleDialogInput:function(t){t||ye.commit("dialogs/hideDialog")},dropPerson:function(t){confirm("Are you sure you want to delete "+t.name+"?")&&this.$store.commit("vehicles/deletePerson",t)},updatePerson:function(t,e,n){var i;this.$store.commit("vehicles/updatePerson",f["a"]({},this.personList[t],(i={},i[n]=e,i)))},personExists:function(t,e){return e.toLowerCase()in this.personByLowercaseKey},flashError:function(t,e){var n,i=this;this.errors=f["a"]({},this.errors,(n={},n[t.toString()]=e,n)),setTimeout((function(){if(i.errors[t.toString()]===e){var n=i.errors,r=t.toString(),a=(n[r],f["c"](n,["symbol"===Object(rt["a"])(r)?r:r+""]));i.errors=a}}),4e3)},maybeCreatePerson:function(){var t=this;if(this.newPerson.name){var e=this.newPerson,n=e.name,i=e.telephone;if(this.personExists(null,n))return this.flashError("new","This person ("+n+") already exists");ye.commit("vehicles/updatePerson",{name:n,telephone:i,created:Date.now(),updated:Date.now()}),this.newPerson={name:null,telephone:null},this.$nextTick((function(){var e=n,i=t.$refs.personsGrid.find((function(t){return t.dataset.key===e})),r=i&&f["d"](i.querySelectorAll(".cell"));r&&r[1].focus()}))}}}}),ji=Fi,Vi=(n("b47d"),Object(bt["a"])(ji,Bi,Mi,!1,null,"ab70a566",null)),Wi=Vi.exports,Ui=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("StandardDialog",{attrs:{name:"manifest",title:"Trip manifest"}},[n("div",{attrs:{slot:"header"},slot:"header"},[n("v-checkbox",{attrs:{label:"Show hidden trips"},model:{value:t.showHiddenTrips,callback:function(e){t.showHiddenTrips=e},expression:"showHiddenTrips"}})],1),n("ManifestComponent",{attrs:{showHiddenTrips:t.showHiddenTrips}})],1)},Xi=[],Ki=i["default"].extend({data:function(){return{showHiddenTrips:!1}},components:{StandardDialog:Ei,ManifestComponent:Un},computed:{dateformat:function(){return D.a}},methods:{handleDialogInput:function(){this.$store.commit("dialogs/hideDialog")}}}),Gi=Ki,Ji=Object(bt["a"])(Gi,Ui,Xi,!1,null,null,null),zi=Ji.exports,qi=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("StandardDialog",{attrs:{title:"Message Log",name:"messages",height:"80vh"}},[n("v-layout",{attrs:{column:""}},[n("v-flex",[n("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[n("v-text-field",t._g({staticStyle:{width:"250px"},attrs:{value:t.maxTime&&t.dateformat(t.maxTime,"dd mmm yyyy"),clearable:"",label:"Messages sent on or before",readonly:""},on:{"click:clear":function(e){return t.handleDateInput(null)}}},i))]}}])},[n("v-date-picker",{attrs:{value:t.maxTime,max:t.dateformat(Date.now(),"yyyy-mm-dd")},on:{input:t.handleDateInput}})],1)],1),n("v-flex",{attrs:{grow:"",shrink:""}},[n("table",{staticClass:"messages-table",staticStyle:{width:"100%"}},[n("thead",[n("tr",[n("th",{staticStyle:{width:"4em"}},[t._v("S/No")]),n("th",{staticStyle:{width:"20em"}},[t._v("Recipients")]),n("th",{staticStyle:{width:"20em"}},[t._v("Date")]),n("th",{staticStyle:{width:"60%"}},[t._v("Message")])])]),n("tbody",t._l(t.currentPage.data,(function(e,i){return n("tr",{key:e.id},[n("td",[t._v(t._s(i+1))]),n("td",[t._v(t._s(e.recipients.join(", ")))]),n("td",[t._v(t._s(e.created&&t.dateformat(e.created,"dd mmm yyyy, HH:MM:ss")))]),n("td",[t._v(" "+t._s(e.message)+" "),n("MessageStatusChecker",{attrs:{status:e.status,id:e.id},on:{updated:function(t){e.status=t}}})],1)])})),0),n("tfoot",[n("tr",[n("td",{attrs:{colspan:"4"}},[n("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.loadMore(e)}}},[t._v("Load more")])])])])])])],1)],1)},Yi=[],Qi=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{staticClass:"message-status-checker"},["unsent"===t.status?[t._v("  ")]:"sent"===t.status?[t._v("  ")]:[t._v(" ? ")]],2)},Zi=[],tr=i["default"].extend({props:["status","id"],data:function(){return{unwatch:null}},computed:{isWatching:function(){return"unsent"===this.status}},watch:{isWatching:{immediate:!0,handler:function(){this.isWatching?(this.unwatch&&this.unwatch(),this.watch()):this.unwatch&&this.unwatch()}}},methods:{watch:function(){var t=this,e=function(e){e&&t.$emit("updated",e.val())};_.ref("/sms/"+this.id+"/status").on("value",e),this.unwatch=function(){t.unwatch=null,_.ref("/sms/"+t.id+"/status").off("value",e)}}}}),er=tr,nr=(n("92a9"),Object(bt["a"])(er,Qi,Zi,!1,null,"47102bcc",null)),ir=nr.exports,rr=i["default"].extend({data:function(){return{currentPage:{data:[]},maxTime:null,errors:{}}},components:{MessageStatusChecker:ir,PersonView:li,StandardDialog:Ei},computed:{dateformat:function(){return D.a},vehicles:function(){return ye.state.vehicles.vehicles},teams:function(){return ye.state.trips.teams||[]},scheduleByTeam:function(){return ye.state.trips.scheduleByTeam}},created:function(){this.loadData(),this.$messageClient=new _n(_)},methods:{loadData:function(t){var e=this;if(void 0===t&&(t=null),!this.$inflightPromise)var n=_.ref("/sms").orderByChild("created"),i=t?n.endAt(t-1e-14*t):n,r=this.$inflightPromise=i.limitToLast(20).once("value").then((function(t){if(e.$inflightPromise===r){var n=wn(t);n.forEach((function(t){e.currentPage.data.push(t)})),e.$inflightPromise=null}}),(function(t){console.error(t),e.$inflightPromise=null}))},loadMore:function(){if(0===this.currentPage.data.length)this.loadData(null);else{var t=this.currentPage.data;this.loadData(t[t.length-1].created)}},handleDateInput:function(t){this.maxTime=t,this.currentPage.data=[],this.$inflightPromise=null,this.loadData(null===t?null:new Date(t+"T23:59:59.999+0800").getTime())}}}),ar=rr,sr=(n("d9bf"),Object(bt["a"])(ar,qi,Yi,!1,null,null,null)),or=sr.exports,lr=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("StandardDialog",{attrs:{title:"Send SMS",name:"draftMessage",height:"80vh"}},[n("h3",[t._v("Send to: "),t._l(t.persons,(function(e,i){return[e.name?n("span",{key:i},[t._v(" "+t._s(e.name)+" ("+t._s(e.telephone)+") ")]):n("span",{key:i},[t._v(" "+t._s(e.telephone)+" ")]),i<t.persons.length-1?[t._v(",")]:t._e()]}))],2),n("v-alert",{attrs:{value:t.hasPersonsMissingPhoneNumbers}},[t._v(" Some people on this list do not have phone numbers. "),n("strong",[t._v("They will not receive your message")]),t._v(". Please update the phone number list before continuing. "),n("v-btn",{on:{click:function(e){return t.$store.commit("dialogs/showDialog","persons")}}},[t._v(" Update the phone number list. ")])],1),n("div",{staticClass:"message-bubble"},[n("v-textarea",{ref:"message",attrs:{label:"Message",rows:"5","auto-grow":""},model:{value:t.m.message,callback:function(e){t.$set(t.m,"message",e)},expression:"m.message"}})],1),n("v-btn",{attrs:{color:"primary"},on:{click:t.sendMessageAndClose}},[t._v(" Send ")]),n("v-btn",{on:{click:function(e){return t.$store.commit("dialogs/hideDialog")}}},[t._v(" Cancel ")])],1)},ur=[],cr=i["default"].extend({props:["recipients","message","trip"],data:function(){return{m:{recipients:[],message:""}}},components:{StandardDialog:Ei},created:function(){this.$messageClient=new _n(_),this.m.recipients=this.recipients,this.m.message=this.message},mounted:function(){var t=this.$refs["message"];this.$nextTick((function(){t.$el.querySelector("textarea").select()}))},computed:{persons:function(){return this.recipients.map((function(t){return ye.getters["vehicles/personArray"].find((function(e){return e.telephone===t}))||{telephone:t}}))},hasPersonsMissingPhoneNumbers:function(){return this.recipients.length<[ye.state.trips.trips[this.trip].driver,ye.state.trips.trips[this.trip].medic].filter((function(t){return Boolean(t)})).length}},methods:{sendMessageAndClose:function(){this.$messageClient.createMessage({recipients:this.m.recipients,message:this.m.message.trim(),trip:this.trip}),this.trip&&ye.state.trips.trips[this.trip]&&ye.commit("trips/markTripSMSSent",{tripId:this.trip}),ye.commit("dialogs/hideDialog")}}}),dr=cr,pr=(n("83a8"),Object(bt["a"])(dr,lr,ur,!1,null,null,null)),mr=pr.exports,fr=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("StandardDialog",{attrs:{name:"templates",title:"Trip templates"}},[n("v-layout",{staticStyle:{height:"75vh"}},[n("v-list",{staticClass:"template-list-section"},[t._l(t.templates,(function(e){return n("v-list-tile",{key:e.id,class:{active:t.selectedTemplateId===e.id},on:{click:function(n){t.selectedTemplateId=e.id}}},[n("v-layout",[n("div",[t._v(" "+t._s(e.name)+" ")]),n("v-spacer"),n("v-icon",{on:{click:function(n){return t.startEditingTemplate(e)}}},[t._v("edit")]),n("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[n("v-icon",t._g({},i),[t._v("more_horiz")])]}}],null,!0)},[n("v-list",[n("v-list-tile",{on:{click:function(n){return t.handleDeleteClick(e.id)}}},[t._v(" Delete ")])],1)],1)],1)],1)})),n("v-list-tile",[n("v-text-field",{attrs:{placeholder:"(Create new template)"},on:{change:function(e){return t.insertTemplate(e)}},model:{value:t.newTemplate,callback:function(e){t.newTemplate=e},expression:"newTemplate"}})],1)],2),n("div",{staticClass:"table-section"},[t.previewTrips?n("v-item-group",{staticClass:"table-toolbar"},[n("v-btn",{on:{click:t.addTemplateJobsToSchedule}},[t._v("Add All")])],1):t._e(),n("div",{staticClass:"table-scroll"},[n("table",{staticClass:"templates-table"},[n("thead",[n("tr",[n("th",[t._v("Team")]),n("th",[t._v("Start")]),n("th",[t._v("End")]),n("th",[t._v("Description")]),n("th",[t._v("Actions")])])]),t.previewTrips?n("tbody",t._l(t.previewTrips,(function(e){return n("tr",{key:e.id,class:{cancelled:e.cancelled}},[n("td",[t._v(t._s(e.driver)+", "+t._s(e.medic))]),n("td",[t._v(t._s(t.dateformat(e.startTime,"HH:MM",!0)))]),n("td",[t._v(t._s(e.endTime&&t.dateformat(e.endTime,"HH:MM",!0)))]),n("td",[n("div",[t._v(t._s(e.description))]),e.startAddress||e.startLocation?n("div",[n("b",[t._v("From: ")]),t._v(t._s(e.startAddress)+" "+t._s(e.startLocation))]):t._e(),e.endAddress||e.endLocation?n("div",[n("b",[t._v("To: ")]),t._v(t._s(e.endAddress)+" "+t._s(e.endLocation)+" ")]):t._e()]),n("td",["date"===t.$store.state.trips.mode.type?[t.scheduleHasTrip(e)?n("div",[n("a",{attrs:{href:"#"},on:{click:function(n){return n.preventDefault(),t.scrollToTrip(t.templateToScheduledTrip[e.id])}}},[t._v(" "+t._s(e.driver)+", "+t._s(e.medic)+" "),n("br"),t._v(" "+t._s(t.dateformat(e.startTime,"HH:MM",!0))+" ")])]):n("v-btn",{attrs:{icon:""},on:{click:function(n){return t.addTripToSchedule(e)}}},[n("v-icon",[t._v("add")])],1)]:t._e()],2)])})),0):t._e()])])],1)],1)],1)},hr=[],vr=i["default"].extend({data:function(){return{newTemplate:"",selectedTemplateId:null,previewTrips:null}},computed:{templates:function(){return m.a.values(this.$store.state.templates.templates)},dateformat:function(){return D.a},templateToScheduledTrip:function(){return m.a.keyBy(this.$store.getters["trips/trips"].filter((function(t){return t.templateTrip})),"templateTrip")},scheduleHasTrip:function(){var t=this;return function(e){return e.id in t.templateToScheduledTrip}}},watch:{selectedTemplateId:function(t){var e=this;t&&(this.previewTrips=null,K({type:"template",template:t,lastTimestamp:0}).then((function(t){e.previewTrips=t})))}},components:{StandardDialog:Ei},created:function(){this.$store.dispatch("templates/readTemplates")},methods:{insertTemplate:function(t){this.$store.dispatch("templates/updateTemplate",{name:t,id:v(),created:Date.now()}),this.newTemplate=""},handleDeleteClick:function(t){confirm("Are you sure you want to delete this template?")&&this.$store.dispatch("templates/deleteTemplate",{id:t})},startEditingTemplate:function(t){var e=this.$store.state.trips.mode,n={type:"template",template:t.id,lastTimestamp:"date"===e.type?e.timestamp:e.lastTimestamp};this.$store.dispatch("trips/setMode",n),this.$store.commit("dialogs/hideDialog")},addTemplateJobsToSchedule:function(t){var e,n;if(this.previewTrips)try{for(var i=f["e"](this.previewTrips),r=i.next();!r.done;r=i.next()){var a=r.value;this.scheduleHasTrip(a)||this.addTripToSchedule(a)}}catch(s){e={error:s}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}},addTripToSchedule:function(t){if("date"===this.$store.state.trips.mode.type){var e=f["a"]({},t,{created:Date.now(),templateTrip:t.id,id:v()});if(e.relatedTrip){var n=Object.values(this.$store.state.trips.trips).find((function(t){return t.templateTrip===e.relatedTrip}));n&&(e.relatedTrip=n.id,this.$store.commit("trips/updateTrip",{tripId:n.id,updates:{relatedTrip:e.id}}))}this.$store.commit("trips/assignNewlyCreatedJob",{trip:e})}},scrollToTrip:function(t){this.$store.commit("dialogs/hideDialog"),this.$store.commit("tripEditing/editTrip",{tripId:t.id}),Ve.$emit("scrollToTime",t.startTime),Ve.$emit("scrollToTeam",E(t))}}}),gr=vr,Tr=(n("ffde"),Object(bt["a"])(gr,fr,hr,!1,null,"3e514a42",null)),yr=Tr.exports,br=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("StandardDialog",{attrs:{title:"Import teams from date",name:"importTeams"}},[n("v-layout",[n("v-date-picker",{attrs:{landscape:""},on:{input:t.updatePreview},model:{value:t.selectedDate,callback:function(e){t.selectedDate=e},expression:"selectedDate"}}),n("div",{staticClass:"preview-pane"},[n("table",{staticClass:"preview-table"},[n("thead",[n("tr",[n("th"),n("th",[t._v("Driver")]),n("th",[t._v("Medic")]),n("th",[t._v("Vehicle")])])]),t.preview?n("tbody",t._l(t.preview.slice(0,100),(function(e,i){return n("tr",{key:i},[n("td"),n("td",[e.driver?[t._v(t._s(e.driver))]:n("span",{staticClass:"placeholder"},[t._v("(No driver)")])],2),n("td",[e.medic?[t._v(t._s(e.medic))]:n("span",{staticClass:"placeholder"},[t._v("(No medic)")])],2),n("td",[e.vehicle?[t._v(t._s(e.vehicle))]:n("span",{staticClass:"placeholder"},[t._v("(No vehicle)")])],2)])})),0):t._e()])])],1),n("div",[n("v-btn",{attrs:{disabled:null===t.selectedDate,color:"primary"},on:{click:t.handleImport}},[t._v("Import")])],1)],1)},wr=[],_r=i["default"].extend({data:function(){return{selectedDate:L(new Date(Date.now()-864e5)),preview:null}},components:{StandardDialog:Ei},mounted:function(){this.updatePreview()},methods:{handleDialogInput:function(){this.$store.commit("dialogs/hideDialog")},updatePreview:function(){var t=this;this.selectedDate?P({type:"date",timestamp:new Date(this.selectedDate).getTime()}).then((function(e){t.preview=e})):this.preview=null},handleImport:function(){var t=this;this.selectedDate&&P({type:"date",timestamp:new Date(this.selectedDate).getTime()}).then((function(e){var n=m.a.keyBy(t.$store.state.trips.teams,E),i=e.filter((function(t){return!(E(t)in n)}));t.$store.commit("trips/updateTeams",t.$store.state.trips.teams.concat(i)),t.$store.commit("dialogs/showDialog","teams")}))}}}),Sr=_r,xr=(n("0b09"),Object(bt["a"])(Sr,br,wr,!1,null,"76f0c2a5",null)),Dr=xr.exports,Ar=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div")},Er=[],Cr=i["default"].extend({mounted:function(){_.ref("/vehicles").on("value",(function(t){if(t){var e=/^([0-9]{4})-([0-9]{2})-([0-9]{2}) ([0-9]{2}):([0-9]{2}):([0-9]{2})$/,n=function(t){var n=t.match(e);return n?new Date(parseInt(n[1]),parseInt(n[2])-1,parseInt(n[3]),parseInt(n[4]),parseInt(n[5]),parseInt(n[6])).getTime():null},i=t.val(),r=m.a.values(i).map((function(t){return{created:n(t.created)||0,direction:parseInt(t.direction),registrationNumber:t.registrationNumber,speed:parseInt(t.speed),lat:parseFloat(t.lat),lng:parseFloat(t.lng),location:t.location,vehicleStatus:t.vehicleStatus}}));ye.commit("vehicles/setVehicles",m.a.sortBy(r,"registrationNumber"))}})),_.ref("/persons").on("value",(function(t){if(t){var e=t.val(),n=Object.entries(e||{}).map((function(t){var e=f["b"](t,2),n=e[0],i=e[1];return{name:n,telephone:i.telephone||null,updated:parseFloat(i.updated)||Date.now(),created:parseFloat(i.created)||Date.now()}}));ye.commit("vehicles/setPersons",n)}}))}}),kr=Cr,$r=Object(bt["a"])(kr,Ar,Er,!1,null,null,null),Lr=$r.exports,Br=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div")},Mr=[],Ir=i["default"].extend({computed:{mode:function(){return this.$store.state.trips.mode},relPath:function(){return $(this.mode)}},created:function(){var t=this,e=function(e){if(e){var n=function(t){return t.map((function(t){var e=V(t.id);return e?f["a"]({},t,e):t}))};t.autoUpdateTrips({trips:n(G(e)),tripsKey:e.key||""})}},n=function(e){e&&t.autoUpdateTrips({teams:H(e),teamsKey:e.key||""})};this.$watch("relPath",(function(t,i){i&&t!==i&&(_.ref("/trips/"+i).off("value",e),_.ref("/teams/"+i).off("value",n)),_.ref("/trips/"+t).on("value",e),_.ref("/teams/"+t).on("value",n)}),{immediate:!0})},methods:{autoUpdateTrips:function(t){this.$store.dispatch("trips/autoUpdateTrips",t)}}}),Pr=Ir,Hr=Object(bt["a"])(Pr,Br,Mr,!1,null,null,null),Or=Hr.exports;var Nr='\nch\tkim\t\t\t1400\t1130\t\t\tEvent\t\tRiver Hongbao @ Floating Platform\nbd\tjamil\t\t\t730\t1100\t\t\tEvent\t262.15\tCross country @ Chinese Garden, Darshini\nYazid\tMee\t\t\t1030\t1400\t\t\tEvent\t224.7\tLuncheon Event @ Raffles City Convention Centre, Siti\nKt\tNo\t\t\t800\t1800\t\t\tEvent\t\tExplomo Event @ Outside Track 13, Claraence 91728765\nch\tkim\t\t\t700\t1200\t\t\tEvent\t347.75\tCross country @ Bedok Reservoir Park, Stephanie 67841234\nIr\tYati\t\t\t1300\t1600\t\t\tEvent\t\tVolleyball @ Delta Sport Hall\nSg\tSur\tBd\tJm\t800\t\t1345\t\tOV\t110\tOV Sims L1 --\x3e TTSH "2A" Pt JohnAw OWC\nAug\tHad\tYas\tAt\t930\t\t1330\t\t2W\t90\t106 Pasir Ris St 12 #XX-XXX -> CGH, Stretcher, Need 02, MOM Azizah 91271234\nPor\tRed\tPor\tRed\t1015\t\t1245\t\t2W\t90\t686 Jurong West Ctrl #XX-XXX -> NCC, OWC, 96771234\nMd\tCt\t\t\t1100\t1300\t\t\tEvent\t171.2\tShooting @ Kampong Glam Caf, Shaikh Ahmad 83721234\nPor\tRed\t\t\t930\t\t\t\tDis\t50\tSGH Wd 48-24-10 --\x3e Assisi Hospice Pt Lee John SN Lante 63211234\tCancelled\nYazid\tMee\t\t\t800\t\t\t\tLKH\t80\tLKH Main Blk L2 -> SGH, Pt Kim John, OWC, SN Jonathan 62871234\nHai\tAmm\tBd\tJm\t1015\t\t1210\t\t2W\t90\tNTUC NH @ Jurong West -> NTFH Tower A73, OWC, 96171234 Brother will bring down Pt from NH\nHai\tAmm\t\t\t900\t\t\t\tDis\t50\tSGH W57-10-1 -> Pacific NH Seetoh John\tCancelled\nBH\tVL\t\t\t1000\t\t\t\tDC\t60\t263 Boon Lay Dr #XX-XXX --\x3e SGH AE Mdm Loh 94228950\n\t\t\t\t1400\t\t\t\tOV\t90\t450 AMK Ave 10 #XX-XXX -> OV Balestier L5, Pt Tee John, OWC\tCancelled\nBH\tVL\tHuq\tHaz\t1345\t\t1500\t\t2W\t90\tSt Andrew @ Henderson L4-48 -> NUH Kent Ridge Wing, Pt Lau John, OWC, 97731234 / 96631234\nHuq\tHaz\tHuq\tHaz\t1415\t\t1800\t\tOV\t90\tOV Simei L6 -> NUH L3 Main Bld Heart Ctr Pt Suan John, MRSA Pt, Stretcher\nYazid\tAt\tBh\tVl\t1530\t\t1830\t\tOv\t110\tOv Simei L3 -> CGH L2, Pt Tau John, OWC\nSg\tSur\tSg\tSur\t1400\t\t1500\t\tOV\t90\tOV Biggin Hill 52B -> Sata Tampines, Pt Anwar John, Sn Abel, Stretcher, Wait around 20 - 30 mins\nYaz\tAt\tSg\tSur\t1330\t\t1600\t\tOV\t90\tOV Simei L2 -> CGH B Main Bld L2, Pt Rokiah Jane, Stretcher, 94691234\nPor\tRed\t\t\t1500\t\t\t\tDis\t50\tAMK CH L2 Wd1 West Wing Bed 1315 -> 269A Yishun St 22 #XX-XXX, Pt Lee John, Motorized WC, Need Lifter, SN Robbie 64501234, Collect cash from Wd\nSt\tSh\t\t\t250\t\t\t\tSGH\t74.9\tSGH Fever Ctr -> KKH A/E\nSt\tSh\t\t\t640\t\t\t\tDC\t150\t718 Jurong West St 71 #XX-XXX -> NUH A/E, 97941234\nIr\tYati\t\t\t920\t\t\t\tDC\t100\t113 AMK Ave 4 #XX-XXX -> TTSH A/E 92751234\nSg\tSur\t\t\t946\t\t\t\t1777\t150\t304 Hougang Ave 5 #XX-XXX -> TTSH A/E 98461234\nSg \tSur\t\t\t1300\t\t\t\tOV\t45\tRaffles Hosp L9 B966 -> OV Sims L3 R2 B12, Pt Pua John SXX247E, MRSA\nHuq\tHas\t\t\t1300\t\t\t\tOV\t60\tOV Simei L6 -> SGH A/E Pt Tang Jane\nHai\tAmm\t\t\t1300\t\t\t\tSGH\t48.15\tSGH Obs r 10-5 -> AH-10-4-12 Pt Pok John\nHai\tAmm\t\t\t1500\t\t\t\tDis\t50\tCGH Wd45-84 -> 165 Tampines St 12 #09-305, Pt Lim Jane 96651234\nBd\tJm\t\t\t1430\t\t\t\tOV\t60\tOV Sims L3 -> TTSH A/E Pt Lim John\nBH\tVl\t\t\t1430\t\t\t\tDC\t100\t63 Circuit Road #10-281 -> SGH A/E 98621234\nGv\tCt\t\t\t1525\t\t\t\t1777\t170\t642A Punggol Drive #XX-XXX -> TTSH A/E 98271234\nSt\tSh\t\t\t2200\t\t\t\tDC\t150\t121 BB West Ave #XX-XXX -> NTFH A/E 96261234\nSt\tSh\t\t\t2310\t\t\t\tOv\t100\tOV Marsiling L3 -> KTPH A/E\nSt\tSh\t\t\t20\t\t\t\tSKH\t160\tSKH A/E -> SGH Wd 44\nSt\tSh\t\t\t640\t\t\t\tSGH\t150\t718 Jurong West St 71 -> NUH A/E\nSt\tSh\t\t\t250\t\t\t\tSGH\t74.9\tSGH -> KKH Pt Jan John\nZid\tMu\t\t\t2100\t\t\t\tSt Luke\t90\tSt Luke -> NUH A/E\nMid\tZim\t\t\t2000\t\t\t\tKTPH\t85.6\tKTPH A/E -> SGH A/E IPT ID 21000\n';function Rr(t){if(""===t)return null;var e=t.padStart(4,"0"),n=parseInt(e.substring(0,2)),i=parseInt(e.substring(2,4));return 36e5*n+6e4*i}var Fr=function(){var t=new Date,e=Nr.split("\n").filter(Boolean).map((function(t){return t.split("\t")})).map((function(e){return{trip:{id:v(),driver:e[0]||null,medic:e[1]||null,startTime:Rr(e[4]),endTime:Rr(e[5]),created:Date.now(),updated:Date.now(),startPostcode:null,endPostcode:null,startAddress:null,endAddress:null,startLocation:null,endLocation:null,startLatLng:null,endLatLng:null,description:"test trip",cancelled:!1,isTentative:!1,relatedTrip:null,isReturnTrip:!1,templateTrip:null,hideFromManifest:!1,lastSMSTimestamp:null},secondTrip:e[2]||e[3]||e[6]?{id:v(),driver:e[2]||null,medic:e[3]||null,startTime:Rr(e[6]),endTime:Rr(e[7]),created:Date.now(),updated:Date.now(),startPostcode:null,endPostcode:null,startAddress:null,endAddress:null,startLocation:null,endLocation:null,startLatLng:null,endLatLng:null,description:"test trip",cancelled:!1,isTentative:!1,relatedTrip:null,isReturnTrip:!1,templateTrip:null,hideFromManifest:!1,lastSMSTimestamp:null}:null,date:Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()),type:e[8],price:e[9]?parseFloat(e[9]):null,description:e[10],cancelled:"Cancelled"===e[11],startPostcode:null,endPostcode:null,startAddress:null,endAddress:null,startLocation:null,endLocation:null,startLatLng:null,endLatLng:null,templateTrip:null}}));return e},jr=i["default"].extend({name:"app",data:function(){return{xAxisScale:150,yAxisScale:25}},computed:{_:function(){return m.a},chartAreaWidth:function(){return 24*this.xAxisScale},chartAreaHeight:function(){return ye.getters["trips/rowCount"]*this.yAxisScale},trips:function(){return ye.getters["trips/trips"]},teamSchedules:function(){return ye.getters["trips/teamSchedules"]},templateName:function(){var t=this.$store.state.trips.mode;if("template"===t.type){var e=t.template,n=Object.values(this.$store.state.templates.templates).find((function(t){return t.id===e}));return n?n.name:e}}},components:{ChartArea:Ge,DatePicker:Hn,DraftMessageDialog:mr,ImportTeamsDialog:Dr,ManifestDialog:zi,MessagesDialog:or,PersonsDialog:Wi,PrintableManifest:Jn,TimeUpdater:Ht,TeamList:$t,TeamsDialog:Li,TemplatesDialog:yr,TripEditor:$n,TripsSync:Or,VehiclesSync:Lr},created:function(){Y(this.$store)},mounted:function(){this.scrollToCurrentTime()},methods:{scrollToCurrentTime:function(){this.$refs["chart-area"].scrollToCurrentTime()},showDialog:function(t){ye.commit("dialogs/showDialog",t)},createNewTrip:function(){var t=new Date;t.setHours(0,0,0,0);var e=Date.now()-t.getTime()+6e5,n=5*Math.ceil(e/5/6e4)*6e4,i=ye.state.trips.mode,r=function(t,e){var n=new Date(t);return n.getFullYear()===e.getFullYear()&&n.getMonth()===e.getMonth()&&n.getDate()===e.getDate()};"date"===i.type&&r(i.timestamp,t)?(ye.dispatch("tripEditing/createAndEditNewTripAtTime",{time:Math.min(855e5,n)}),this.scrollToCurrentTime()):ye.dispatch("tripEditing/createAndEditNewTripAtTime",{time:Math.min(855e5,9e5*Math.ceil(this.$store.state.screen.scrollTime/9e5))})},importJobs:function(){ye.commit("trips/importJobs",Fr())},goBack:function(){var t=this.$store.state.trips.mode,e={type:"date",timestamp:"date"===t.type?t.timestamp:t.lastTimestamp};this.$store.dispatch("trips/setMode",e)},signOut:function(){this.$store.dispatch("login/signOut")}}}),Vr=jr,Wr=(n("5c0b"),n("2cc6"),Object(bt["a"])(Vr,c,d,!1,null,"07166cc9",null)),Ur=Wr.exports,Xr=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.isLoggedIn?n("div",[t._t("default")],2):null===t.errorReading?n("div",{staticClass:"not-logged-in"},[n("div",[t._v("Loading...")])]):n("div",{staticClass:"not-logged-in"},[n("div",[n("h1",[t._v("Welcome to AMS Bookings Planner")]),t.loggedInUser&&t.errorReading?n("v-alert",{attrs:{value:!0,type:"error"}},[t._v(" You are not authorized to access AMS Bookings Planner ")]):t._e(),n("v-btn",{attrs:{color:"primary"},on:{click:t.signInGoogle}},[t._v(" Sign In with Google ")])],1)])},Kr=[],Gr=i["default"].extend({data:function(){return{errorReading:null}},computed:{loggedInUser:function(){return this.$store.state.login.user},isLoggedIn:function(){return!(this.errorReading||!this.loggedInUser)}},watch:{loggedInUser:function(){this.testAuth()}},mounted:function(){var t=this,e=S.onAuthStateChanged((function(e){t.$store.commit("login/updateUser",e&&e.email)}));this.$on("destroyed",(function(){return e()})),this.testAuth()},methods:{testAuth:function(){var t=this;K(this.$store.state.trips.mode).then((function(){t.errorReading=!1})).catch((function(){t.errorReading=!0}))},signInGoogle:function(){var t=new b.a.auth.GoogleAuthProvider;t.addScope("email"),this.$store.dispatch("login/signInWithPopup",t)}}}),Jr=Gr,zr=(n("933c"),Object(bt["a"])(Jr,Xr,Kr,!1,null,"d36fc7c8",null)),qr=zr.exports,Yr=i["default"].extend({components:{App:Ur,RequiresLogin:qr}}),Qr=Yr,Zr=Object(bt["a"])(Qr,l,u,!1,null,null,null),ta=Zr.exports,ea={googleMapsApiKey:"AIzaSyDesj7zbyR3W906S_H3rq-y2Ao3_yh7qRI"},na=n("755e");n("bf40"),n("d1e78");a.config.productionTip=!1,a.use(o.a),a.use(na,{load:{key:ea.googleMapsApiKey,libraries:["places"]}}),a.directive("draggable",{bind:function(t){t.draggable=!0}}),new a({store:ye,render:function(t){return t(ta)}}).$mount("#app")},cff9:function(t,e,n){},d9bf:function(t,e,n){"use strict";var i=n("1537"),r=n.n(i);r.a},de9b:function(t,e,n){},defd:function(t,e,n){"use strict";var i=n("78e9"),r=n.n(i);r.a},e14d:function(t,e,n){},eaa3:function(t,e,n){},ff08:function(t,e,n){},ffde:function(t,e,n){"use strict";var i=n("2f76"),r=n.n(i);r.a}});
//# sourceMappingURL=index.8d767ae9.js.map